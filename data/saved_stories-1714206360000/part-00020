{"aid": "40176462", "title": "Post-Mortem of the Matrix.org Outage", "url": "https://matrix.org/blog/2024/04/morg-post-mortem/", "domain": "matrix.org", "votes": 2, "user": "Sami_Lehtinen", "posted_at": "2024-04-27 02:04:14", "comments": 0, "source_title": "Post-mortem of the Matrix.org Outage", "source_text": "Matrix.org - Post-mortem of the Matrix.org Outage\n\n# Post-mortem of the Matrix.org Outage\n\n25.04.2024 16:20 \u2014 Foundation \u2014 SRE Team, Thib\n\nThe Matrix.org homeserver suffered from an outage on Monday 22 April, between\n08:00 UTC and 10:00 UTC, followed by slowness for the next 2 hours.\n\nThe outage occurred during scheduled maintenance with no expected downtime. It\nincluded upgrading the base OS of the machines running Matrix.org\u2019s\ndeployment.\n\n## Technical cause\n\nThe Matrix.org homeserver is large. To operate at this scale and distribute\nthe load on several machines, it relies on Synapse workers.\n\nThe first machines upgraded only ran stateless workers and were trivial to\nupgrade. Upgrading the machines with stateful workers was more difficult. To\navoid downtime, the stateful workers had to be moved to other machines from\nthe same deployment, and be restarted.\n\nThe machines that received the additional workers ended up being resource-\nstarved. In the meantime, it took significant time to upgrade the free machine\nand bring its network back online before we could move the workers back to it\nto better share the load.\n\n## Organizational cause\n\nMatrix.org is a historical and complex deployment that is difficult and costly\nto replicate entirely in a staging environment at this scale. It is also the\nlargest deployment in the federation and has unique performance requirements.\n\nThrough this upgrade process, gaps in the deployment documentation were\nidentified and these gaps contributed to the upgrade taking longer than\nexpected. The deployment specificity has now been properly documented, and we\nare confident that the next machines\u2019 upgrade will be significantly faster.\n\n## Lessons learned\n\nTo perform an upgrade without downtime, the Foundation would need to add\nanother server in the deployment of the Matrix.org homeserver, as a\nconsequence of steadily increasing traffic. An extra server introduces a\nrecurring cost and requires additional work that the Foundation cannot afford\nright now.\n\nThe next upgrade will have about an hour of planned downtime and will be\nannounced shortly. In the meantime, the Foundation is investigating the most\ncost-effective way to improve redundancy on matrix.org.\n\n## The Foundation needs you\n\nThe Matrix.org Foundation is a non-profit and only relies on donations to\noperate. Its core mission is to maintain the Matrix Specification, but it does\nmuch more than that.\n\nIt maintains the matrix.org homeserver and hosts several bridges for free. It\nfights for our collective rights to digital privacy and dignity.\n\nSupport us\n\n### Post Contents\n\n  * Technical cause\n  * Organizational cause\n  * Lessons learned\n\nDonate Shop Security Disclosure Policy Security Hall of Fame Code of Conduct\nLegal Contact Site Source\n\nCopyright Notice\n\n", "frontpage": false}
