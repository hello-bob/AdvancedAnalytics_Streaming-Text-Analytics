{"aid": "40132154", "title": "Forcing a System Crash from the Keyboard", "url": "https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/forcing-a-system-crash-from-the-keyboard", "domain": "microsoft.com", "votes": 2, "user": "numpad0", "posted_at": "2024-04-23 14:06:30", "comments": 0, "source_title": "Forcing a System Crash from the Keyboard - Windows drivers", "source_text": "Forcing a System Crash from the Keyboard - Windows drivers | Microsoft Learn\n\nSkip to main content\n\n## Microsoft Build\n\nMay 21\u201323, 2024\n\nAI has disrupted the industry. Join us as we disrupt it some more.\n\nRegister now\n\nThis browser is no longer supported.\n\nUpgrade to Microsoft Edge to take advantage of the latest features, security\nupdates, and technical support.\n\nDownload Microsoft Edge More info about Internet Explorer and Microsoft Edge\n\nLearn\n\nSign in\n\nLearn\n\nSign in\n\nWindows\n\nRead in English\n\n# Forcing a system crash from the keyboard\n\n  * Article\n  * 12/21/2023\n\nThe following types of keyboards can cause a system crash directly:\n\n  * PS/2 keyboards connected on i8042prt ports This feature is available in Windows 2000 and later versions of the Windows operating system.\n\n  * USB keyboards This feature is available in Windows Vista and later versions of the Windows operating system.\n\n  * Hyper-V keyboards This feature is available in Windows 10 version 1903 and later versions of the Windows operating system.\n\n## Configuration\n\nConfigure the following settings to enable a system crash using the keyboard:\n\n  1. If you want a crash dump file to be written, you must enable such dump files. Choose the path and file name, and select the size of the dump file. For more information, see Enabling a kernel-mode dump file.\n\n  2. With PS/2 keyboards, you must enable the keyboard-initiated crash in the registry. In the registry key HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\i8042prt\\Parameters, create a value named CrashOnCtrlScroll, and set it equal to a REG_DWORD value of 0x01.\n\n  3. With USB keyboards, you must enable the keyboard-initiated crash in the registry. In the registry key HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\kbdhid\\Parameters, create a value named CrashOnCtrlScroll, and set it equal to a REG_DWORD value of 0x01.\n\n  4. With Hyper-V keyboards, you must enable the keyboard-initiated crash in the registry. In the registry key HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\hyperkbd\\Parameters, create a value named CrashOnCtrlScroll, and set it equal to a REG_DWORD value of 0x01.\n\nSome laptops use the PS/2 driver for the built-in keyboard and also support\nexternal HID keyboards. For these systems, consider creating both the USB and\nPS/2 registry keys to allow the use of either keyboard.\n\nYou must restart the system for these settings to take effect.\n\nOnce the restart is completed, the keyboard crash can be initiated by using\nthe following hotkey sequence: Hold down the rightmost CTRL key, and press the\nSCROLL LOCK key twice.\n\nThe system then calls KeBugCheck and issues Bug check 0xE2:\nMANUALLY_INITIATED_CRASH. Unless crash dumps have been disabled, a crash dump\nfile is then written.\n\nIf a kernel debugger is attached to the crashed machine, the machine will\nbreak into the kernel debugger after the crash dump file has been written.\n\n## Defining alternate keyboard shortcuts to force a system crash from the\nkeyboard\n\nYou can configure alternate values under the following registry subkeys for\nkeyboard shortcut sequences to generate the memory dump file:\n\n  * For PS/2 keyboards:\n\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\i8042prt\\crashdump\n\n  * For USB keyboards:\n\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\kbdhid\\crashdump\n\n  * For Hyper-V keyboards:\n\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\hyperkbd\\crashdump\n\nYou must create the following registry REG_DWORD values under these subkeys:\n\n## Dump1Keys\n\nThe Dump1Keys registry value is a bit map of the first hotkey to use. For\nexample, instead of using the rightmost CTRL key to initiate the hotkey\nsequence, you can set the first hotkey to be the leftmost SHIFT key.\n\nThe values for the first hot key are described in the following table.\n\nValue| First Key used in the keyboard shortcut sequence  \n---|---  \n0x01| Rightmost SHIFT key  \n0x02| Rightmost CTRL key  \n0x04| Rightmost ALT key  \n0x10| Leftmost SHIFT key  \n0x20| Leftmost CTRL key  \n0x40| Leftmost ALT key  \n  \nYou can assign Dump1Keys a value that enables one or more keys as the first\nkey used in the keyboard shortcut sequence. For example, assign Dump1Keys a\nvalue of 0x11 to define both the rightmost and leftmost SHIFT keys as the\nfirst key in the keyboard shortcut sequence.\n\nDump2Key\n\nThe Dump2Key registry value is the index in the scan code table for the\nkeyboard layout of the target computer. See the actual table in the driver:\n\n    \n    \n    const UCHAR keyToScanTbl[134] = { 0x00,0x29,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09, 0x0A,0x0B,0x0C,0x0D,0x7D,0x0E,0x0F,0x10,0x11,0x12, 0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1A,0x1B,0x00, 0x3A,0x1E,0x1F,0x20,0x21,0x22,0x23,0x24,0x25,0x26, 0x27,0x28,0x2B,0x1C,0x2A,0x00,0x2C,0x2D,0x2E,0x2F, 0x30,0x31,0x32,0x33,0x34,0x35,0x73,0x36,0x1D,0x00, 0x38,0x39,0xB8,0x00,0x9D,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0xD2,0xD3,0x00,0x00,0xCB, 0xC7,0xCF,0x00,0xC8,0xD0,0xC9,0xD1,0x00,0x00,0xCD, 0x45,0x47,0x4B,0x4F,0x00,0xB5,0x48,0x4C,0x50,0x52, 0x37,0x49,0x4D,0x51,0x53,0x4A,0x4E,0x00,0x9C,0x00, 0x01,0x00,0x3B,0x3C,0x3D,0x3E,0x3F,0x40,0x41,0x42, 0x43,0x44,0x57,0x58,0x00,0x46,0x00,0x00,0x00,0x00, 0x00,0x7B,0x79,0x70 };\n\nIndex 124 (sysreq) is a special case because an 84-key keyboard has a\ndifferent scan code.\n\nIf you define alternate keyboard shortcuts to force a system crash from a USB\nor PS/2 keyboard, you must either set the CrashOnCtrlScroll registry value to\n0 or remove it from the registry.\n\nExample: In this scenario, a laptop uses a PS2 keyboard driver, and an\nexternal HID keyboard is attached. Setting both values provides the ability to\ntrigger a manual system crash from either keyboard. A manual system crash can\nbe forced by holding the rightmost control key and pressing the spacebar twice\nwhen the following registry key is set.\n\n    \n    \n    [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\i8042prt\\crashdump] \"Dump1Keys\"=dword:00000002 \"Dump2Key\"=dword:0000003d [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\kbdhid\\crashdump] \"Dump1Keys\"=dword:00000002 \"Dump2Key\"=dword:0000003d\n\n## Limitations\n\nIt's possible but rare for a system to freeze in such a way that the keyboard\nshortcut sequence doesn't work. Using the keyboard shortcut sequence to\ninitiate a crash will work even in many instances where CTRL+ALT+DELETE\ndoesn't work.\n\nForcing a system crash from the keyboard doesn't work if the computer stops\nresponding at a high interrupt request level (IRQL). This limitation exists\nbecause the Kbdhid.sys driver, which allows the memory dump process to run,\noperates at a lower IRQL than the i8042prt.sys driver.\n\n## See also\n\nBug check 0xE2: MANUALLY_INITIATED_CRASH\n\n!analyze -v\n\nAnalyzing a Kernel-Mode Dump File with WinDbg\n\nBug Check 0x161: LIVE_SYSTEM_DUMP\n\nGenerate a kernel or complete crash dump\n\nVarieties of Kernel-Mode Dump Files.\n\n## Feedback\n\nWas this page helpful?\n\nProvide product feedback |\n\nGet help at Microsoft Q&A\n\n## Feedback\n\nComing soon: Throughout 2024 we will be phasing out GitHub Issues as the\nfeedback mechanism for content and replacing it with a new feedback system.\nFor more information see: https://aka.ms/ContentUserFeedback.\n\nSubmit and view feedback for\n\nThis product This page\n\nView all page feedback\n\n## Additional resources\n\nEnglish (United States)\n\nYour Privacy Choices\n\n  * Previous Versions\n  * Blog\n  * Contribute\n  * Privacy\n  * Terms of Use\n  * Trademarks\n  * \u00a9 Microsoft 2024\n\n## Additional resources\n\nEnglish (United States)\n\nYour Privacy Choices\n\n  * Previous Versions\n  * Blog\n  * Contribute\n  * Privacy\n  * Terms of Use\n  * Trademarks\n  * \u00a9 Microsoft 2024\n\n", "frontpage": false}
