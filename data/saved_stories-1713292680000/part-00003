{"aid": "40050776", "title": "Show HN: Lock-State Service \u2013 Easily manage locks in your jobs / pipelines", "url": "https://lock-states.deno.dev", "domain": "lock-states.deno.dev", "votes": 2, "user": "worotyns", "posted_at": "2024-04-16 11:39:11", "comments": 0, "source_title": null, "source_text": "# LSS\n\nLock State Service for lock(s) management.\n\nWith just a few API calls, you can create, check, and modify your locks.\n\nSample usecases:\n\n  * Github actions - eg. like lock QA branch deployment when E2E testing is turning on etc,\n  * System CRONs, that can be \"locked\",\n  * Other cases when on system level (curl access) you want to stop executing in flow.\n\nThis service can be used for free with low workloads.\n\n## Create new lock\n\nHTTP POST https://lock-states.deno.dev/locks\n\n### Url params:\n\n  * l=true|1|T optional if set, new lock will be \"locked\" by default\n  * e=ttl_in_seconds optional\n\n### Returns:\n\n  * 200 = created\n\n### Examples:\n\n    \n    \n    curl -X POST https://lock-states.deno.dev/locks { \"lockId\":\"01hvkab4t422rap18rwjs2prnm\", \"lockKey\":\"b749f750-fbe3-11ee-9224-d7fd2399170d\", }\n\nlockId is your lock identity and lockKey you should use as ?k= url param when\nyou want to lock/unlock\n\nThis lock will be locked by default and expire after 60 seconds\n\n    \n    \n    curl -X POST https://lock-states.deno.dev/locks?l=t&e=60 { \"lockId\":\"01hvkab4t422rap18rwjs2prnm\", \"lockKey\":\"b749f750-fbe3-11ee-9224-d7fd2399170d\", }\n\n## Get lock state\n\nHTTP GET https://lock-states.deno.dev/locks/:lockId\n\n### Returns:\n\n  * 204 = unlocked\n  * 423 = locked\n  * 404 = not found\n\n### Examples:\n\n#### When unocked:\n\n    \n    \n    curl -X GET https://lock-states.deno.dev/locks/01hvkab4t422rap18rwjs2prnm -I HTTP/2 204\n\n#### When locked:\n\n    \n    \n    curl -X GET https://lock-states.deno.dev/locks/01hvkab4t422rap18rwjs2prnm -I HTTP/2 423\n\n## Lock\n\nHTTP PATCH https://lock-states.deno.dev/locks/:lockId/lock\n\n### Url params:\n\n  * k=lockKey required for auth\n  * e=ttl_in_seconds optional\n\n### Returns:\n\n  * 204 = ok\n  * 401 = unauthorized\n  * 404 = not found\n  * 500 = internal server error\n\n### Examples:\n\nLock forever\n\n    \n    \n    curl -X PATCH \"https://lock-states.deno.dev/locks/01hvkab4t422rap18rwjs2prnm/lock?k=b749f750-fbe3-11ee-9224-d7fd2399170d\" -I HTTP/2 204\n\nLock for 60 seconds:\n\n    \n    \n    curl -X PATCH \"https://lock-states.deno.dev/locks/01hvkab4t422rap18rwjs2prnm/lock?k=b749f750-fbe3-11ee-9224-d7fd2399170d&e=60\" -I HTTP/2 204\n\n## Unlock\n\nHTTP PATCH https://lock-states.deno.dev/locks/:lockId/unlock\n\n### Url params:\n\n  * k=lockKey required for auth\n\n### Returns:\n\n  * 204 = ok\n  * 401 = unauthorized\n  * 404 = not found\n  * 500 = internal server error\n\n### Example:\n\n    \n    \n    curl -X PATCH \"https://lock-states.deno.dev/locks/01hvkab4t422rap18rwjs2prnm/unlock?k=b749f750-fbe3-11ee-9224-d7fd2399170d\" -I HTTP/2 204\n\n## Usecases\n\n### Examples:\n\n#### How to use in \"shell\" eg. to stop github actions pipeline\n\nExits with error code with -f curl flag\n\n    \n    \n    curl -X GET https://lock-states.deno.dev/locks/01hvkab4t422rap18rwjs2prnm -f && echo \"there is no lock\" curl: (22) The requested URL returned error: 423\n\nNo exits with error code with -f curl flag\n\n    \n    \n    curl -X GET https://lock-states.deno.dev/locks/01hvkab4t422rap18rwjs2prnm -f && echo \"there is no lock\" there is no lock\n\n## Others\n\n### Discussion\n\nHackerNews\n\n### Repository\n\nGithub\n\n### License\n\nCopyright 2024 worotyns@icloud.com\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n\n", "frontpage": false}
