{"aid": "40100482", "title": "Passim: A Local Caching Server", "url": "https://github.com/hughsie/passim", "domain": "github.com/hughsie", "votes": 1, "user": "nicolaslem", "posted_at": "2024-04-20 19:56:08", "comments": 0, "source_title": "GitHub - hughsie/passim: A local caching server", "source_text": "GitHub - hughsie/passim: A local caching server\n\nSkip to content\n\nSign in\n\n# Search code, repositories, users, issues, pull requests...\n\nSearch syntax tips\n\nSign in\n\nSign up\n\nYou signed in with another tab or window. Reload to refresh your session. You\nsigned out in another tab or window. Reload to refresh your session. You\nswitched accounts on another tab or window. Reload to refresh your session.\nDismiss alert\n\nhughsie / passim Public\n\n  * Notifications\n  * Fork 7\n  * Star 62\n\nA local caching server\n\n### License\n\nLGPL-2.1 license\n\n62 stars 7 forks Branches Tags Activity\n\nStar\n\nNotifications\n\n# hughsie/passim\n\nThis commit does not belong to any branch on this repository, and may belong\nto a fork outside of the repository.\n\n1 Branch\n\n8 Tags\n\n## Folders and files\n\nName| Name| Last commit message| Last commit date  \n---|---|---|---  \n  \n## Latest commit\n\nhughsieRelease 0.1.7Apr 17, 2024516785f \u00b7 Apr 17, 2024Apr 17, 2024\n\n## History\n\n129 Commits  \n  \n### .github\n\n|\n\n### .github\n\n| trivial: Harden GitHub Actions| Apr 15, 2024  \n  \n### contrib\n\n|\n\n### contrib\n\n| trivial: Add BR of gettext in the example spec file| Apr 15, 2024  \n  \n### data\n\n|\n\n### data\n\n| Release 0.1.7| Apr 17, 2024  \n  \n### libpassim\n\n|\n\n### libpassim\n\n| Show the auto-generated name in 'passim status'| Apr 15, 2024  \n  \n### po\n\n|\n\n### po\n\n| trivial: Update translations for Weblate| Apr 15, 2024  \n  \n### src\n\n|\n\n### src\n\n| Fix a small memory leak when parsing a request with duplicate sha256=...|\nApr 17, 2024  \n  \n### .clang-format\n\n|\n\n### .clang-format\n\n| Initial version| Jul 27, 2023  \n  \n### LICENSE\n\n|\n\n### LICENSE\n\n| Initial commit| Jul 21, 2023  \n  \n### README.md\n\n|\n\n### README.md\n\n| trivial: Add a OpenSSF Best Practices Badge| Apr 17, 2024  \n  \n### RELEASE\n\n|\n\n### RELEASE\n\n| trivial: post release version bump| Apr 15, 2024  \n  \n### SECURITY.md\n\n|\n\n### SECURITY.md\n\n| trivial: Add a SECURITY.md| Apr 15, 2024  \n  \n### meson.build\n\n|\n\n### meson.build\n\n| trivial: Fix overzealous search-replace to fix compile warnings| Apr 17,\n2024  \n  \n### meson_options.txt\n\n|\n\n### meson_options.txt\n\n| Add a new shared library for clients| Jul 27, 2023  \n  \n## Repository files navigation\n\n# Passim\n\nA local caching server. Named after the Latin word for \u201chere, there and\neverywhere\u201d.\n\n## Introduction\n\nMuch of the software running on your computer that connects to other systems\nover the Internet needs to periodically download metadata or information\nneeded to perform other requests.\n\nAs part of running the passim/LVFS projects I've seen how download this small\nfile once per 24h turns into tens of millions of requests per day. Everybody\ndownloads the same file from a CDN, and although a CDN is not super-expensive,\nit's certainly not free. Everybody on your current network (perhaps thousands\nof users) has to download the same 1MB blob of metadata from a CDN over a\nperhaps-expensive internet link.\n\nWhat if we could download the file from the CDN on one machine, and the next\nmachine on the local network that needs it instead downloads it from the first\nmachine? We could put a limit on the number of times it can be shared, and the\nmaximum age so that we don't store yesterdays metadata forever, and so that we\ndon't turn a ThinkPad X220 into a machine distributing 1Gb/s to every other\nmachine in the office. We could cut the CDN traffic by at least one order of\nmagnitude, but possibly much more. This is better for the person paying the\ncloud bill, the person paying for the internet connection, and the planet as a\nwhole.\n\nThis is what passim tries to be. You add automatically or manually add files\nto the daemon which stores them in /var/lib/passim/data with attributes set on\neach file for the max-age and share-limit. When the file has been shared more\nthan the share limit number of times, or is older than the max age it is\ndeleted and not advertised to other clients.\n\nThe daemon then advertises the availability of the file as a mDNS service\nsubtype and provides a tiny single-threaded webserver that supplies the file\nusing HTTP using a self-signed TLS certificate.\n\nThe file is sent when requested from a URL like\nhttps://192.168.1.1:27500/filename.xml.gz?sha256=hash -- any file requested\nwithout the checksum will not be supplied. Although this is a chicken-and-egg\nproblem where you don't know the payload checksum until you've checked the\nremote server, this is easy solved using a tiny <100 byte request to the CDN\nfor the payload checksum (or a .jcat file) and then the multi-megabyte (or\nmulti-gigabyte!) payload can be requested over mDNS.\n\n## Sharing Considerations\n\nHere we've assuming your local network (aka LAN) is a nice and friendly place,\nwithout evil people trying to overwhelm your system or feed you fake files.\nAlthough we request files by their hash (and thus can detect tampering) it\nstill uses resources to send a file over the network.\n\nWe'll assume that any network with working mDNS (as implemented in Avahi) is\ngood enough to get metadata from other peers. If Avahi is not running, or mDNS\nis turned off on the firewall then no files will be shared.\n\nThe cached index is available locally without any kind of authentication --\nboth over mDNS and as a webpage on https://localhost:27500/.\n\nSo, NEVER ADD FILES TO THE CACHE THAT YOU DO NOT WANT TO SHARE. Even the\nfilename may give more clues than you wanted to provide, e.g. sharing a file\nmight get you in trouble. This can be subtle; if you download a security\nupdate for a Lenovo P1 Gen 3 laptop and share it with other laptops on your\nLAN -- it also tells the attacker your laptop model and also that you're\nrunning a system firmware that isn't patched against the latest firmware bug.\n\nMy recommendation here is only to advertise files that are common to all\nmachines. For instance:\n\n  * AdBlocker metadata\n  * Firmware update metadata\n  * Remote metadata for update frameworks, e.g. apt-get/dnf etc.\n\n## Implementation Considerations\n\nAny client MUST (and I'll go as far as to say it again, MUST) calculate the\nchecksum of the supplied file and verify that it matches. There is no\nauthentication or signing verification done so this step is non-optional. A\nmalicious server could advertise the hash of firmware.xml.gz but actually\nsupply evil-payload.exe -- and you do not want that.\n\n## Static Data\n\nPassim can also add the contents of static directories, and offer those to\nclients. This might be useful if you have a big directory of thousands of\nfiles (an LVFS mirror, for example) that you want to distribute from a\ndedicated machine.\n\nTo set this up, create a keyfile with a unique name and extension .conf,\nsomething like /etc/passim.d/lvfs.conf with the contents:\n\n    \n    \n    [passim] Path=/srv/lvfs/downloads/\n\nThe running daemon will be notified this file has been created, scan the\ncontents, and publish them for other users. If passimd has write permissions\non the directory, it will also write an xattr of user.checksum.sha256 which\nwill speed up the next daemon restart considerably.\n\n## Firewall Configuration\n\nPort 27500 should be open by default, but if downloading files fails you can\nopen the port using firewalld:\n\n    \n    \n    $ firewall-cmd --permanent --zone=public --add-port=27500/tcp\n\n## Comparisons\n\nThe obvious comparison to make is IPFS. I'll try to make this as fair as\npossible, although I'm obviously somewhat biased.\n\nIPFS:\n\n  * existing project that's existed for many years tested by many people\n  * allows sharing with other users not on your local network\n  * not packaged in many distributions and not trivial to install correctly\n  * requires a significant time to find resources\n  * does not prioritize local clients over remote clients\n  * requires a internet<->IPFS \"gateway\" which cost $$$ for a large number of files\n\nPassim:\n\n  * new project that's not even finished\n  * only allowed sharing with computers on your local network\n  * returns results within 2s\n\nOne concern we had specifically with IPFS with firmware were ITAR/EAR legal\nconsiderations. e.g. we can't share firmware containing strong encryption with\nusers in some countries. From an ITAR/EAR point of view Passim would be\ncompliant (as it only shares locally) and IPFS would not be.\n\n## Debugging\n\n    \n    \n    $ curl -v -k https://localhost:27500/HELLO.md?sha256=a948904f2f0f479b8f8197694b30184b0d2ed1c1cd2a1ec0fb85d299a192a447 -L * Trying 127.0.0.1:27500... * Connected to localhost (127.0.0.1) port 27500 (#0) * ALPN: offers h2,http/1.1 * TLSv1.3 (OUT), TLS handshake, Client hello (1): * TLSv1.3 (IN), TLS handshake, Server hello (2): * TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8): * TLSv1.3 (IN), TLS handshake, Certificate (11): * TLSv1.3 (IN), TLS handshake, CERT verify (15): * TLSv1.3 (IN), TLS handshake, Finished (20): * TLSv1.3 (OUT), TLS change cipher, Change cipher spec (1): * TLSv1.3 (OUT), TLS handshake, Finished (20): * SSL connection using TLSv1.3 / TLS_AES_256_GCM_SHA384 * ALPN: server accepted http/1.1 * Server certificate: * subject: [NONE] * start date: Aug 15 20:13:03 2023 GMT * expire date: Dec 31 23:59:59 9999 GMT * using HTTP/1.1 > GET /HELLO.md?sha256=a948904f2f0f479b8f8197694b30184b0d2ed1c1cd2a1ec0fb85d299a192a447 HTTP/1.1 > Host: localhost:27500 > User-Agent: curl/8.0.1 > Accept: */* > < HTTP/1.1 302 Found < Server: passim libsoup/3.4.2 < Date: Tue, 15 Aug 2023 20:37:10 GMT < Location: https://192.168.122.39:27500/sha256=a948904f2f0f479b8f8197694b30184b0d2ed1c1cd2a1ec0fb85d299a192a447?sha256=a948904f2f0f479b8f8197694b30184b0d2ed1c1cd2a1ec0fb85d299a192a447 < Content-Type: text/html < Content-Length: 227 < * Ignoring the response-body * Connection #0 to host localhost left intact * Issue another request to this URL: 'https://192.168.122.39:27500/sha256=a948904f2f0f479b8f8197694b30184b0d2ed1c1cd2a1ec0fb85d299a192a447?sha256=a948904f2f0f479b8f8197694b30184b0d2ed1c1cd2a1ec0fb85d299a192a447' * Trying 192.168.122.39:27500... * Connected to 192.168.122.39 (192.168.122.39) port 27500 (#1) * ALPN: offers h2,http/1.1 * TLSv1.3 (OUT), TLS handshake, Client hello (1): * TLSv1.3 (IN), TLS handshake, Server hello (2): * TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8): * TLSv1.3 (IN), TLS handshake, Certificate (11): * TLSv1.3 (IN), TLS handshake, CERT verify (15): * TLSv1.3 (IN), TLS handshake, Finished (20): * TLSv1.3 (OUT), TLS change cipher, Change cipher spec (1): * TLSv1.3 (OUT), TLS handshake, Finished (20): * SSL connection using TLSv1.3 / TLS_AES_256_GCM_SHA384 * ALPN: server accepted http/1.1 * Server certificate: * subject: [NONE] * start date: Aug 15 20:27:28 2023 GMT * expire date: Dec 31 23:59:59 9999 GMT * using HTTP/1.1 > GET /sha256=a948904f2f0f479b8f8197694b30184b0d2ed1c1cd2a1ec0fb85d299a192a447?sha256=a948904f2f0f479b8f8197694b30184b0d2ed1c1cd2a1ec0fb85d299a192a447 HTTP/1.1 > Host: 192.168.122.39:27500 > User-Agent: curl/8.0.1 > Accept: */* > < HTTP/1.1 200 OK < Server: passim libsoup/3.4.2 < Date: Tue, 15 Aug 2023 20:37:11 GMT < Content-Disposition: attachment; filename=\"a948904f2f0f479b8f8197694b30184b0d2ed1c1cd2a1ec0fb85d299a192a447-HELLO.md\" < Content-Type: text/markdown < Content-Length: 12 < hello world * Connection #1 to host 192.168.122.39 left intact\n\nUsing the CLI:\n\n    \n    \n    $ passim dump 7ea83bf1f9505f1e846cddef0d8ee49f6fd19361e2eb2f2e4f371b86382eacc2 HELLO.md (max-age: 86400, share-limit: 5) $ sudo passim publish /var/lib/passim/metadata/lvfs/metadata.xml.xz 60 44 7ea83bf1f9505f1e846cddef0d8ee49f6fd19361e2eb2f2e4f371b86382eacc2 HELLO.md (max-age: 86400, share-limit: 5) 0157efe3cdab369a17b68facb187df1c559c91e2771c9094880ff2019ad84eaf metadata.xml.xz (max-age: 60, share-count: 0, share-limit: 44)\n\n# TODO:\n\n  * Self tests\n\n## About\n\nA local caching server\n\n### Resources\n\nReadme\n\n### License\n\nLGPL-2.1 license\n\n### Security policy\n\nSecurity policy\n\nActivity\n\n### Stars\n\n62 stars\n\n### Watchers\n\n6 watching\n\n### Forks\n\n7 forks\n\nReport repository\n\n## Releases 8\n\n0.1.7 Latest\n\nApr 17, 2024\n\n\\+ 7 releases\n\n## Packages 0\n\nNo packages published\n\n## Contributors 11\n\n## Languages\n\n  * C 90.6%\n  * Meson 5.6%\n  * Python 3.2%\n  * Other 0.6%\n\n## Footer\n\n\u00a9 2024 GitHub, Inc.\n\nYou can\u2019t perform that action at this time.\n\n", "frontpage": false}
