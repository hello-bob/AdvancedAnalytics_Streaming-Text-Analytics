{"aid": "40143406", "title": "Show HN: Edge-CSRF \u2013 CSRF protection on edge workers (Next.js, SvelteKit)", "url": "https://github.com/kubetail-org/edge-csrf", "domain": "github.com/kubetail-org", "votes": 1, "user": "andres", "posted_at": "2024-04-24 12:09:38", "comments": 0, "source_title": "GitHub - kubetail-org/edge-csrf: CSRF protection library for JavaScript that runs on the edge runtime (Next.js middleware, SvelteKit hooks)", "source_text": "GitHub - kubetail-org/edge-csrf: CSRF protection library for JavaScript that\nruns on the edge runtime (Next.js middleware, SvelteKit hooks)\n\nSkip to content\n\n## Navigation Menu\n\nSign in\n\n# Search code, repositories, users, issues, pull requests...\n\nSearch syntax tips\n\nSign in\n\nSign up\n\nYou signed in with another tab or window. Reload to refresh your session. You\nsigned out in another tab or window. Reload to refresh your session. You\nswitched accounts on another tab or window. Reload to refresh your session.\nDismiss alert\n\nkubetail-org / edge-csrf Public\n\n  * Notifications\n  * Fork 5\n  * Star 101\n\nCSRF protection library for JavaScript that runs on the edge runtime (Next.js\nmiddleware, SvelteKit hooks)\n\n### License\n\nMIT license\n\n101 stars 5 forks Branches Tags Activity\n\nStar\n\nNotifications\n\n# kubetail-org/edge-csrf\n\nThis commit does not belong to any branch on this repository, and may belong\nto a fork outside of the repository.\n\n3 Branches\n\n21 Tags\n\n## Folders and files\n\nName| Name| Last commit message| Last commit date  \n---|---|---|---  \n  \n## Latest commit\n\namoreysmall improvements to docs (#38)Apr 22, 2024e6c2a29 \u00b7 Apr 22, 2024Apr\n22, 2024\n\n## History\n\n53 Commits  \n  \n### .github/workflows\n\n|\n\n### .github/workflows\n\n| 2.0.0 (#36)| Apr 21, 2024  \n  \n### examples\n\n|\n\n### examples\n\n| 2.0.0 (#36)| Apr 21, 2024  \n  \n### packages\n\n|\n\n### packages\n\n| small improvements to docs (#38)| Apr 22, 2024  \n  \n### shared\n\n|\n\n### shared\n\n| 2.0.0 (#36)| Apr 21, 2024  \n  \n### .eslintrc.cjs\n\n|\n\n### .eslintrc.cjs\n\n| 2.0.0 (#36)| Apr 21, 2024  \n  \n### .gitignore\n\n|\n\n### .gitignore\n\n| 2.0.0 (#36)| Apr 21, 2024  \n  \n### LICENSE\n\n|\n\n### LICENSE\n\n| 1.0.10 (#27)| Apr 13, 2024  \n  \n### README.md\n\n|\n\n### README.md\n\n| small improvements to docs (#38)| Apr 22, 2024  \n  \n### SECURITY.md\n\n|\n\n### SECURITY.md\n\n| 2.0.0 (#36)| Apr 21, 2024  \n  \n### package.json\n\n|\n\n### package.json\n\n| 2.0.0 (#36)| Apr 21, 2024  \n  \n### pnpm-lock.yaml\n\n|\n\n### pnpm-lock.yaml\n\n| 2.0.0 (#36)| Apr 21, 2024  \n  \n### pnpm-workspace.yaml\n\n|\n\n### pnpm-workspace.yaml\n\n| 2.0.0 (#36)| Apr 21, 2024  \n  \n### set-version.sh\n\n|\n\n### set-version.sh\n\n| 2.0.0 (#36)| Apr 21, 2024  \n  \n### tsconfig.json\n\n|\n\n### tsconfig.json\n\n| 2.0.0 (#36)| Apr 21, 2024  \n  \n## Repository files navigation\n\n# Edge-CSRF\n\nEdge-CSRF is a CSRF protection library for JavaScript that runs on the edge\nruntime.\n\nThe Edge-CSRF library helps you to implement the signed double submit cookie\npattern except it only uses edge runtime dependencies so it can be used in\nboth node environments and in edge functions (e.g. Vercel Edge Functions,\nCloudflare Page Functions). The recommended way to use this library is via its\ndrop-in integrations for Next.js and SvelteKit though it also has a lower-\nlevel API for more custom implementations.\n\nWe hope you enjoy using this software. Contributions and suggestions are\nwelcome!\n\n## Features\n\n  * Runs on both node and edge runtimes\n  * Includes a Next.js integration (see here)\n  * Includes a SvelteKit integration (see here)\n  * Includes a low-level API for custom integrations (see here)\n  * Handles form-urlencoded, multipart/form-data or json-encoded HTTP request bodies\n  * Gets token from HTTP request header or from request body\n  * Supports Server Actions via form and non-form submission\n  * Customizable cookie and other options\n\n## Integrations\n\n  * Next.js\n  * SvelteKit\n  * Core API\n\n## Quickstart (Next.js)\n\nFirst, install Edge-CSRF's Next.js integration library:\n\n    \n    \n    npm install @edge-csrf/nextjs # or pnpm add @edge-edge-csrf/nextjs # or yarn add @edge-csrf/nextjs\n\nNext, create a middleware file (middleware.ts) for your project and add the\nEdge-CSRF middleware:\n\n    \n    \n    // middleware.ts import { createCsrfMiddleware } from '@edge-csrf/nextjs'; // initalize csrf protection middleware const csrfMiddleware = createCsrfMiddleware({ cookie: { secure: process.env.NODE_ENV === 'production', }, }); export const middleware = csrfMiddleware;\n\nNow, all HTTP submission requests (e.g. POST, PUT, DELETE, PATCH) will be\nrejected if they do not include a valid CSRF token. To add the CSRF token to\nyour forms, you can fetch it from the X-CSRF-Token HTTP response header\nserver-side or client-side. For example:\n\n    \n    \n    // app/page.tsx import { headers } from 'next/headers'; export default function Page() { const csrfToken = headers().get('X-CSRF-Token') || 'missing'; return ( <form action=\"/api/form-handler\" method=\"post\"> <input type=\"hidden\" value={csrfToken}> <input type=\"text\" name=\"my-input\"> <input type=\"submit\"> </form> ); }\n    \n    \n    // app/form-handler/route.ts import { NextResponse } from 'next/server'; export async function POST() { return NextResponse.json({ status: 'success' }); }\n\n## Quickstart (SvelteKit)\n\nFirst, install Edge-CSRF's SvelteKit integration library:\n\n    \n    \n    npm install @edge-csrf/sveltekit # or pnpm add @edge-edge-csrf/sveltekit # or yarn add @edge-csrf/sveltekit\n\nNext, create a server-side hooks file (hooks.server.ts) for your project and\nadd the Edge-CSRF handle:\n\n    \n    \n    // src/hooks.server.ts import { createCsrfHandle } from '@edge-csrf/sveltekit'; // initalize csrf protection handle const csrfHandle = createCsrfHandle({ cookie: { secure: process.env.NODE_ENV === 'production', }, }); export const handle = csrfHandle;\n\nNow, all HTTP submission requests (e.g. POST, PUT, DELETE, PATCH) will be\nrejected if they do not include a valid CSRF token. To add the CSRF token to\nyour forms, you can fetch it from the event's locals data object server-side.\nFor example:\n\n    \n    \n    // src/routes/+page.server.ts export async function load({ locals }) { return { csrfToken: locals.csrfToken, }; } export const actions = { default: async () => { return { success: true }; }, };\n    \n    \n    <!-- src/routes/+page.svelte --> <script lang=\"ts\"> export let data; export let form; </script> {#if form?.success} <span>success</span> {:else} <form method=\"post\"> <input type=\"hidden\" value={data.csrfToken}> <input type=\"text\" name=\"my-input\"> <input type=\"submit\"> </form> {/if}\n\nFinally, to make typescript aware of the new locals attributes you can add\nEdge-CSRF types to your app's types:\n\n    \n    \n    // src/app.d.ts import type { CsrfLocals } from '@edge-csrf/sveltekit'; declare global { namespace App { // ... interface Locals extends CsrfLocals {} // ... } } export {};\n\n## Development\n\n### Get the code\n\nTo develop edge-csrf, first clone the repository then install the\ndependencies:\n\n    \n    \n    git clone git@github.com:kubetail-org/edge-csrf.git cd edge-csrf pnpm install\n\n### Run the unit tests\n\nEdge-CSRF uses jest for testing (via vitest). To run the tests in node, edge\nand miniflare environments, use the test-all command:\n\n    \n    \n    pnpm test-all\n\nThe test files are colocated with the source code in each package's src/\ndirectory, with the filename format {name}.test.ts.\n\n### Build for production\n\nTo build Edge-CSRF for production, run the build command:\n\n    \n    \n    pnpm build\n\nThe build artifacts will be located in the dist/ directory of each package.\n\n## About\n\nCSRF protection library for JavaScript that runs on the edge runtime (Next.js\nmiddleware, SvelteKit hooks)\n\n### Topics\n\nnextjs svelte edge csrf next sveltekit\n\n### Resources\n\nReadme\n\n### License\n\nMIT license\n\n### Security policy\n\nSecurity policy\n\nActivity\n\nCustom properties\n\n### Stars\n\n101 stars\n\n### Watchers\n\n2 watching\n\n### Forks\n\n5 forks\n\nReport repository\n\n## Releases 11\n\n2.0.0 Latest\n\nApr 21, 2024\n\n\\+ 10 releases\n\n## Packages 0\n\nNo packages published\n\n## Languages\n\n  * TypeScript 97.0%\n  * JavaScript 1.6%\n  * Shell 1.4%\n\n## Footer\n\n\u00a9 2024 GitHub, Inc.\n\nYou can\u2019t perform that action at this time.\n\n", "frontpage": false}
