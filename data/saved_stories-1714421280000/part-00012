{"aid": "40197050", "title": "Introducing Notesnook v3", "url": "https://blog.notesnook.com/introducing-notesnook-v3/", "domain": "notesnook.com", "votes": 1, "user": "se7entime", "posted_at": "2024-04-29 11:37:33", "comments": 0, "source_title": "Introducing Notesnook v3", "source_text": "Introducing Notesnook v3\n\nNote linking & at rest encryption is here! Check out what's new in v3.0.0\n\nBlog Privacy for everyone\n\nLoginSign up\n\nPrivacy\n\n# Introducing Notesnook v3\n\nAbdullah AttaApril 29, 2024\n\nFrom August 2023 to April 2024, after 8 months, 1000+ commits, and countless\nsleepless nights v3 is finally here \u2014 the biggest, most feature packed release\nin the history of Notesnook.\n\nIn this release we have rewritten the core architecture of Notesnook,\nintroducing a new Sync Engine, migrating to SQLite, adding support for\ninternal note links, tabs and nested notebooks, alongwith countless big and\nsmall improvements to the UX. v3 is the rebirth of Notesnook as a more mature,\nmore stable note taking experience.\n\nThere's a lot to talk about in this release but let's start with the new\nNotesnook logo.\n\n## The new Notesnook logo\n\nWhen we started out building Notesnook, our logo was the literal visual\nrepresentation of \"notes\" and \"nook\". That concept quickly got outdated after\nrapid iteratation that completely changed how Notesnook functioned. Despite\nall the changes, though, we are still engineers at heart which means we think\nof everything in terms of \"problems\" and \"solutions\". The old logo had a\ncouple of problems:\n\n  1. It wasn't legible in small sizes (e.g. favicons, tray icons, status bar icons etc.)\n  2. It couldn't be themed\n  3. It didn't work well with different colors\n  4. It had a very busy design\n\nThe new logo solves all of these problems and it looks great.\n\nThe new Notesnook logoMaterial UI Themed Logo\n\n## Migrating to SQLite\n\nIf you have been using Notesnook you would never notice that all of it is\nbuilt on a very simple key value database. KV databases are really cool but\nfail miserably if you want to selectively query data, or do partial updates.\nAs a result, when you increase the number of notes in Notesnook, the\nperformance becomes abysmal. I am talking about 30+ seconds to startup the app\nwith 50K notes on iPhone 6s, laggy scrolling, and a simple note taking 10s to\nsave on each edit.\n\nSince this only occured for 20K+ notes, we could afford to be slow for some\ntime but sooner or later we needed a permanent solution. We had the following\noptions:\n\n  1. Optimize the slow parts of the database (essentially building our own database & query engine) and continue shipping.\n  2. Migrate to SQLite\n\nBuilding your own database engine is really not a good idea. I wish we had\nseen this while prototyping Notesnook because while choosing a KV database\nsped up development it forced us to repay that cost later on. Using the right\ntool for the job is crucial for any serious software development.\n\nTo decide our next steps, we set down a few targets:\n\n  1. The clients should perform predictably regardless of how much data you have. Loading 1000 notes should take the same amount of perceivable time as loading 50K notes (i.e. using lazy loading, pagination etc.)\n  2. The clients should use as little RAM as possible to work in extremely constrained enviroments (e.g. our web clipper shouldn't crash on iOS which limits all Share Extensions to around 50mb of RAM).\n  3. Instant startup times regardless of how many notes a user has.\n  4. Future proof (i.e. we shouldn't need to migrate again)\n\nAnd a couple of good to haves:\n\n  1. Scrolling a list with 50K notes at 60 FPS\n  2. Improved search\n  3. Faster saving of notes\n\nKeep the above in mind, the choice was obvious: it was time to migrate to\nSQLite.\n\nIn v3, you will notice the following improvements immediately:\n\n  1. Instant startup even with 50K+ notes (1.5s vs 30s on iPhone 6s)\n  2. Lag free scrolling & navigation\n  3. Exporting notes & taking backups should be faster\n  4. Search should be faster and more accurate\n  5. Faster sync (thanks to the power of SQL)\n  6. Web clipper on mobile should no longer crash if you have a lot of notes\n\nAfter migration, the next obvious step was fixing the sync. Specifically we\nwanted to fix one of the longest standing issue with Notesnook Sync: a change\nyou make on one device sometimes wouldn't sync to other devices and vice\nversa.\n\n## Fixing the sync\n\nFrom the beginning, Notesnook has had a decentralized sync system where each\nclient can independently sync items without depending on a central server.\nThis could only work based on time, of course, but it also had a few\ndrawbacks:\n\n  1. Since each client was independent, it was a nightmare to debug why something wasn't syncing.\n  2. In order to be efficient, we detected changed items based on their modified timestamp but this forced us to juggle with the various inconsistencies of time on different devices.\n  3. Building everything on top of timestamps meant resumability during sync could never be stable.\n\nAs you can imagine, in order for a time based sync system to work without\nissues, time must be the same on all devices at all times. What happens if one\ndevice is ahead/behind by a few milliseconds? Items get missed out of the sync\ncycle, and you have to run a force sync (which sends & fetches all the items\ninstead of only the changed ones).\n\nIt was clear that to properly fix the sync we had to get rid of the time\nfactor. Turns out a centralized architecture is the best way to solve this\nproblem:\n\n  1. Each item has a boolean synced property that becomes false whenever it is changed.\n  2. When pushing changes, we just get all the items with synced set to false.\n  3. The server keeps a list of all unsynced items for each device, and when a device runs the sync it only sends those items.\n\nThis fixes all the problems with a time based sync engine:\n\n  1. Debugging is easier because server has a list of all changes for each device.\n  2. Detecting changed items is just as efficient as comparing their modified time but more stable.\n  3. Resumability comes built-in.\n\nAs a result, in v3 you'll notice a much more reliable sync that \"just works\"\nregardless of where you are, how many devices you are on, or the time\ndifference between them.\n\n#### Background sync on mobile\n\nNotesnook mobile apps will also now automatically sync your notes and other\ndata in the background at regular intervals. This will ensure that you are\nalways synced even if you never open the app. For example, setting a reminder\non the desktop/web app will automatically set it on your phone as well\n(without requiring you to open the app).\n\nBackground sync can be disabled from Settings > Sync Settings > Background\nsync.\n\n#### Merge conflict tolerant sync\n\nIn v2, whenever a merge conflict occured the sync would stop until you\nresolved all the conflicts regardless of whether you made changes in the\nconflicted note(s) or not. This was quite frustrating.\n\nIn v3, we have fixed this: the app will now continue to sync even if you have\nmerge conflicts.\n\n## Features, Features\n\nIt is always a struggle to decide which features to add and which features to\nleave for later. v3 is no different but even then, it is probably one of our\nbiggest releases ever.\n\n### Note linking\n\nThe Crown Jewel of v3!\n\nAfter a long excrutiating wait we have finally added support for linking 2\nnotes in Notesnook. Not just that, you can also link directly to a specific\nblock inside a note. Clicking on the internal link takes you directly to that\nblock.\n\nLink directly to a specific block inside a note.\n\nWe also added controls to quickly see which notes are currently linked, and\nwhich other notes are referencing a particular note.\n\nQuickly see which notes are currently linked.\n\nTo keep things simple, a note link is no different than a normal hyperlink\nexcept that clicking on it will take you to the note instead of an external\npage. When you export your notes, your note links are automatically resolved\nto actual Markdown/ HTML files. This is something no other app (that I know\nof) does instead keeping the links in their app specific format (with note id\nand everything) making them essentially useless after export.\n\n### Tabs\n\nThe only reason we added tabs was to allow quick navigation to/from a note on\nclicking a note link. You can, of course, use tabs without ever linking a\nnote.\n\nTabs in Notesnook.\n\nNotesnook is one of the few note taking apps (besides Obsidian & OneNote) that\nhas a full fledged tab experience. With v3, we are slowly upgrading Notesnook\nto become a poweruser's tool while keeping things just as simple as before.\nWhich brings me to...\n\n### Nested notebooks\n\nWith v3, we are getting rid of \"topics\" as an organization concept, and\nreplacing it with \"subnotebooks\". All your topics will automatically convert\nto subnotebooks after upgrading to v3.\n\nSubnotebooks function similar to a topic except that you can have unlimited\nlevels of subnotebooks. For example, a structure like this was not possible in\nv2:\n\n    \n    \n    - Blogs - Programming - JavaScript - Python - C++ - Privacy - Notesnook - Android - GrapheneOS - Other OSs\n\nComplex structures like this are now possible in v3, and they work just like\nthey did in v2 so you'll feel right at home.\n\n### At rest encryption\n\nNotesnook was always end-to-end encrypted i.e. your notes always got encrypted\non your device before being sent to the cloud. However, those notes weren't\nstored encrypted on your device. For some users, this was a big no-no.\n\nWith v3, we are fixing this short coming of Notesnook. Thanks to SQLite (and\nsqlite-multiple-ciphers), at rest encryption is now a thing on all platforms.\nWhen you first open the app, it will automatically generate an encryption key\nand store it securely in the platform KeyStore/KeyChain. This encryption key\nis then used to encrypt/decrypt the SQLite database.\n\nIn other words, it \"just works\" without any intervention required on your\npart. All sensitive data is encrypted except:\n\n  1. App logs\n  2. On-device settings & configuration\n\n### App lock\n\nAt rest encryption works with or without app lock, but it is recommended that\nyou enable it nonetheless especially on the web app where there is no platform\nKeyChain/KeyStore.\n\n#### Web/Desktop\n\nWhen you enable app lock, it further encrypts your database encryption key\nwith your app lock pin (or security key) so it's not just an \"overlay\". If you\nforget your app lock pin, the only way into the app is to reset & clear the\ndatabase and start over.\n\nSetting up app lock in Notesnook\n\nYou can also setup app lock with your hardware security key (e.g.\nYubiKey/SoloKey) on Chromium-based browsers & the desktop app. Firefox &\nSafari, unfortunately, still do not support the prf extension which is\nrequired for this to work.\n\n#### iOS/Android\n\nOn iOS/Android, the app lock is independent of at rest encryption i.e. setting\nup app lock doesn't further encrypt your database encryption key with the app\nlock credential (e.g. password/biometrics). This is done intentionally due to\nthe following limitations:\n\n  1. Background sync cannot work if app lock is turned on.\n  2. Snoozing/dismissing of reminders becomes impossible because the database cannot be opened without asking the user for the app lock credential.\n  3. Web clipper on mobile cannot work for similar reasons.\n\nSetting up app lock in Notesnook\n\nHowever, this is not a huge concern because the database encryption key is\nalready stored very securely in your phone's KeyStore/KeyChain. In the future,\nwe plan on working around these limitations or offering a \"Super Secure\" mode\nas an opt-in feature on mobile to disable these extra features.\n\n### Export attachments with notes\n\nIn v3, we have improved the export process to include:\n\n  1. Attachments are now exported as separated files (both files & images) instead of getting embedded inside notes.\n  2. Notes are automatically organized based on the notebooks they are in.\n  3. Internal note links are resolved to actual HTML/MD files\n  4. Notes & notebooks with duplicate names are now properly renamed for deduplication.\n\n### User profile\n\nIn v2 we added the ability to personalize Notesnook using themes and in v3 we\nare taking that a step further by allowing you to set up your profile. This\nwill add a personal touch to your Notesnook experience. As always, everything\nis 100% end-to-end encrypted included the profile picture.\n\nUser profile in Notesnook\n\nCurrently your profile is only used for aesthetic purposes. However, in the\nfuture we plan to make use of it for Monographs (optionally), collaboration\netc.\n\n### Custom colors for note organization\n\nEach person has their own color hierarchy. For some, red signifies importance\nbut for others it has a different meaning. Some people can't tolerate a\ncertain shade of red etc. etc. That is why in v3, we are introducing custom\ncolors for organizing your notes.\n\nCustom colors in Notesnook\n\nYou can add as many colors as you like with whatever shade you like. No 2\ncolors can have the same shade, however.\n\n### Customizable side bar\n\nThe side bar is now fully customizable including:\n\n  1. Hiding items you don't use\n  2. Changing the order of items (e.g. move Notebooks to the top)\n  3. Reorganizing the order of shortcuts & colors\n\nCustomizable side bar\n\nIt can be as simple or as complex as you want.\n\n### Callouts\n\nWith callouts you can make certain sections of your notes \"pop\" for better\nreadability. Initially, we have added around 20 types of different callouts\nwhich should suffice.\n\nCallouts are also collapsible and nestable so you can add a callout inside a\ncallout etc.\n\nCallouts in Notesnook editor\n\nAdding a new callout is as simple as:\n\n    \n    \n    >info Callout Title\n\n### Table of Contents\n\nIf you have very long notes with a lot of headings, navigating around can\nbecome really painful. In v3, we have added support for Table of Contents so\nyou can quickly jump around without a lot of scrolling.\n\nTable of contents\n\n### Custom titlebar on Desktop app\n\nA desktop app should look and feel like a desktop app instead of just a\nwrapper around a web app. In v3 we are bringing a fully custom title bar with\nintegrated editor tabs to make things feel more \"desktop-y\".\n\nCustom title bar on desktop\n\nWith this change, we are making more and more use of the native capabilities\nof the platform. Even though the web and desktop apps feel similar in\nfunctionality, their underlying implementations vary a lot:\n\n  1. Desktop app has native encryption, hashing & compression making sync and other things quite a bit faster.\n  2. Desktop app supports automatic backups that get saved to a folder on your disk.\n  3. At rest encryption keys are stored in the platform KeyStore/KeyChain in the desktop app, making it much more secure.\n  4. System tray integration only exists in the desktop app\n  5. And many other things that really makes a difference.\n\n### Change highlighting in merge conflicts\n\nIf you get a lot of merge conflicts, or if you are just comparing 2 note\nversions, it can become really difficult to figure out what actually changed.\nIn v3, we have added change highlighting on all platforms when viewing merge\nconflicts or note versions.\n\nChange highlighting in merge conflicts\n\n### Image compression & multi image upload\n\nEver since we added support for attachments, we have avoided compressing\nimages to allow users to attach images in their full quality. The drawback of\nthis approach is that on some slower platforms like mobile, loading notes with\na lot of images becomes extremely slow and laggy. Another point to consider is\nthat not all images need to be added in their original quality (e.g. receipts,\nscreenshots etc.).\n\nTo fix this performance issue, we are now enabling image compression by\ndefault with a toggle to disable it for specific images.\n\nYou can now attach multiple images at once (on all platforms).\n\n### Other features\n\n  1. Add support for copy/pasting code blocks with syntax highlighting.\n  2. The top bar in note properties sheet now remembers which actions to take more frequently and moves the to top automatically. For example if you use the \"Copy\" action a lot, it automatically moves to start. We have also moved most toggles and single click actions to top bar from the bottom grid.\n  3. Simple checklists \u2014 sometimes you just need a simple checkbox without all the fancy task list features. In this beta version we have added just that. Checklists are barebones version of task lists being extremely lightweight and simple to use.\n  4. Drag/drop notes & notebooks \u2014 you can now drag drop notes and notebooks just like you'd do files on your file browser. Drag a note to a notebook, color or tag and it'll automatically get assigned. Or maybe drag a notebook to another notebook and it'll automatically become its child.\n  5. You can now sort/group your notes by both title & date.\n  6. We have added a \"New Note\" Quick Settings button on Android.\n\n## Get v3 now!\n\nThis release was one of the most stressful releases ever taking over 8 months\nof development, and countless hours of testing. None of this could ever be\npossible without the feedback from our beta users. For the last 3 months, our\nbeta users have helped us find countless bugs & inconsistencies, and we could\nnot be more grateful! Thank you to everyone who contributed, helped,\nmotivated, and shared their feedback.\n\nYou can grab v3 from our official website, and also from the respective app\nstore on your platform.\n\n#opinion#privacy\n\nAbdullah AttaLead developer of Notesnook\n\nNEXT POST The Skiff Privacy Fiasco, or How not to Shutdown Your Startup\n\nNotesnookPrivacy for everyone\n\nOverviewTry for freeMonographsVericryptWeb ClipperImport your\nnotesRoadmapNOTESNOOK VSEvernoteOneNote\n\nLINKSLoginCreate a new accountDownloadsPricingNotesnook for\nEducationHelpGithubBlog\n\nCOMPANYAboutBlogInstagramTwitterEmail\n\n\u00a9 2024 Streetwriters (Private) Ltd.\n\nPrivacy PolicyTerms of Service\n\n", "frontpage": false}
