{"aid": "40164337", "title": "Visualizing the locations of malicious login attempts", "url": "https://romeov.github.io/malicious_ip_addresses/malicious_ip_analysis.html", "domain": "romeov.github.io", "votes": 9, "user": "Bromeo", "posted_at": "2024-04-25 23:32:07", "comments": 0, "source_title": null, "source_text": "Setup...\n\n535 \u03bcs\n\n# Visualizing malicious IP addresses.\n\nI host a simple webserver on a virtual private server (VPS) which get's\nthousands of malicious login attempts a day. This is an attempt to visualize\nwhere these attacks are coming from.\n\nThe machine is running Linux (NixOS), and accessible through the internet via\nssh. At the time of writing, in the last 24h my machine had ~1000 failed login\nattempts via password, and 50 failed login attempts via ssh key.\n\n    \n    \n    $ journalctl --since \"-1d\" -u sshd | grep \"Failed password\" | wc -l $ journalctl --since \"-1d\" -u sshd | grep \"Failed publickey\" | wc -l\n\n## Finding the location of each attacker.\n\njournalctl also provides the IP address of each login attempt. We can use this\nto look up and visualize the locations of the attackers. Anthropic's Claude\nchat model suggested the following curl snippet:\n\n    \n    \n    curl -s \"https://ipinfo.io/$ip/loc\n\nwhich yields the longitude and latitude of a given IP address.\n\nTo get all the unique IPs that have tried loggin in, Claude suggests\n\n    \n    \n    journalctl -u sshd | grep -oE '\\b([0-9]{1,3}\\.){3}[0-9]{1,3}\\b' | sort -u > malicious_ips.txt\n\nPefect. Let's get started processing the IPs.\n\n1.1 msips\n\nString1\n\n    \n    \n    \"0.0.0.0\"\n\n2\n\n    \n    \n    \"100.64.0.1\"\n\n3\n\n    \n    \n    \"100.64.0.4\"\n\n4\n\n    \n    \n    \"101.126.14.128\"\n\n5\n\n    \n    \n    \"101.126.25.183\"\n\n6\n\n    \n    \n    \"101.126.31.21\"\n\n7\n\n    \n    \n    \"101.126.35.124\"\n\n8\n\n    \n    \n    \"101.126.4.240\"\n\n9\n\n    \n    \n    \"101.126.44.124\"\n\n10\n\n    \n    \n    \"101.126.64.237\"\n\n11\n\n    \n    \n    \"101.126.64.240\"\n\n12\n\n    \n    \n    \"101.126.64.41\"\n\n13\n\n    \n    \n    \"101.126.65.210\"\n\n14\n\n    \n    \n    \"101.126.65.80\"\n\n15\n\n    \n    \n    \"101.126.67.16\"\n\n16\n\n    \n    \n    \"101.126.67.168\"\n\n17\n\n    \n    \n    \"101.126.67.18\"\n\n18\n\n    \n    \n    \"101.126.67.197\"\n\n19\n\n    \n    \n    \"101.126.67.221\"\n\n20\n\n    \n    \n    \"101.126.67.226\"\n\nmore5197\n\n    \n    \n    \"96.88.139.105\"\n\n5198\n\n    \n    \n    \"97.74.80.116\"\n\n5199\n\n    \n    \n    \"97.74.95.243\"\n\n5200\n\n    \n    \n    \"98.10.121.246\"\n\n5201\n\n    \n    \n    \"98.128.173.33\"\n\n5202\n\n    \n    \n    \"98.142.141.184\"\n\n5203\n\n    \n    \n    \"98.18.26.150\"\n\n5204\n\n    \n    \n    \"98.202.238.219\"\n\n5205\n\n    \n    \n    \"98.52.116.108\"\n\n5206\n\n    \n    \n    \"99.46.3.41\"\n\nips = collect(readlines(\"/home/romeo/Downloads/malicious_ips.txt\"))\n\n332 \u03bcs\n\nWe have about five thousand unique IP addresses.\n\n321 \u03bcs\n\n    \n    \n    5206\n\nlength(ips)\n\n13.9 \u03bcs\n\nLet's fetch the locations from the API.\n\n275 \u03bcs\n\nget_lon_lat\n\nTry to look up location for an IP address. Returns (0,0) if it fails.\n\n\"Try to look up location for an IP address. Returns `(0,0)` if it fails.\"\n\nfunction get_lon_lat(ip)\n\nlat, lon = try\n\nretval = readchomp(`curl -s \"https://ipinfo.io/$ip/loc\"`)\n\nparse.(Float64, split(retval, ','))\n\ncatch\n\n0,0\n\nend\n\nend\n\n107 msip_locs\n\nAny1Float641\n\n    \n    \n    39.9075\n\n2\n\n    \n    \n    116.397\n\n2Float641\n\n    \n    \n    39.9075\n\n2\n\n    \n    \n    116.397\n\n3Float641\n\n    \n    \n    39.9075\n\n2\n\n    \n    \n    116.397\n\n4Float641\n\n    \n    \n    39.9075\n\n2\n\n    \n    \n    116.397\n\n5Float641\n\n    \n    \n    39.9075\n\n2\n\n    \n    \n    116.397\n\n6Float641\n\n    \n    \n    39.9075\n\n2\n\n    \n    \n    116.397\n\n7Float641\n\n    \n    \n    39.9075\n\n2\n\n    \n    \n    116.397\n\n8Float641\n\n    \n    \n    39.9075\n\n2\n\n    \n    \n    116.397\n\n9Float641\n\n    \n    \n    39.9075\n\n2\n\n    \n    \n    116.397\n\n10Float641\n\n    \n    \n    39.9075\n\n2\n\n    \n    \n    116.397\n\n11Float641\n\n    \n    \n    39.9075\n\n2\n\n    \n    \n    116.397\n\n12Float641\n\n    \n    \n    39.9075\n\n2\n\n    \n    \n    116.397\n\n13Float641\n\n    \n    \n    39.9075\n\n2\n\n    \n    \n    116.397\n\n14Float641\n\n    \n    \n    39.9075\n\n2\n\n    \n    \n    116.397\n\n15Float641\n\n    \n    \n    39.9075\n\n2\n\n    \n    \n    116.397\n\n16Float641\n\n    \n    \n    39.9075\n\n2\n\n    \n    \n    116.397\n\n17Float641\n\n    \n    \n    39.9075\n\n2\n\n    \n    \n    116.397\n\n18Float641\n\n    \n    \n    39.9075\n\n2\n\n    \n    \n    116.397\n\n19Float641\n\n    \n    \n    39.9075\n\n2\n\n    \n    \n    116.397\n\n20Float641\n\n    \n    \n    39.9075\n\n2\n\n    \n    \n    116.397\n\nmore986Float641\n\n    \n    \n    37.566\n\n2\n\n    \n    \n    126.978\n\n987Float641\n\n    \n    \n    37.566\n\n2\n\n    \n    \n    126.978\n\n988Float641\n\n    \n    \n    36.8567\n\n2\n\n    \n    \n    127.443\n\n989Float641\n\n    \n    \n    36.6372\n\n2\n\n    \n    \n    127.49\n\n990Float641\n\n    \n    \n    30.2936\n\n2\n\n    \n    \n    120.161\n\n991Float641\n\n    \n    \n    22.5455\n\n2\n\n    \n    \n    114.068\n\n992Float641\n\n    \n    \n    22.2783\n\n2\n\n    \n    \n    114.175\n\n993Float641\n\n    \n    \n    22.2783\n\n2\n\n    \n    \n    114.175\n\n994Float641\n\n    \n    \n    22.2783\n\n2\n\n    \n    \n    114.175\n\n995Float641\n\n    \n    \n    22.3833\n\n2\n\n    \n    \n    114.183\n\n6.6 ms\n\nWe visualize the results with GeoMakie.jl. Let's make a scatterplot of all the\nIP addresses, plotted on a nice Winkel-Tripel projection.\n\n172 \u03bcs\n\nHere we go!\n\n22.4 ms\n\nscatter!(ga, last.(ip_locs), first.(ip_locs); color=:orange); fig\n\n434 \u03bcs\n\nInteresting! We can see the most locations in India, Indonesia, and China as\nwell as a significant number in the US and Europe. South America notably has\nnone, and neither do Canada, Mexico, Russia, or the Middle East.\n\nI will stick to observations for now, and not further guess the reasons behind\nthese locations.\n\n343 \u03bcs\n\n### Closer inspection.\n\nLet us draw some of these places up closer. Claude once again helpfully gives\nme longitude and latitude limits for each continent, so we can zoom in. Since\nwe are looking at smaller patches of land, let us return to the typical\nmercator projection.\n\n363 \u03bcscontinent_lims\n\nDict{String, NamedTuple{(:lonlims, :latlims)}}Dict\n\n    \n    \n    \"Antarctica\"\n\nlonlims1\n\n    \n    \n    -180.0\n\n2\n\n    \n    \n    180.0\n\nlatlims1\n\n    \n    \n    -90.0\n\n2\n\n    \n    \n    -60.0\n    \n    \n    \"Asia\"\n\nlonlims1\n\n    \n    \n    50\n\n2\n\n    \n    \n    150\n\nlatlims1\n\n    \n    \n    -20.3\n\n2\n\n    \n    \n    50.6\n    \n    \n    \"Europe\"\n\nlonlims1\n\n    \n    \n    -9.5\n\n2\n\n    \n    \n    68.2\n\nlatlims1\n\n    \n    \n    35.9\n\n2\n\n    \n    \n    71.1\n    \n    \n    \"Africa\"\n\nlonlims1\n\n    \n    \n    -17.5\n\n2\n\n    \n    \n    51.4\n\nlatlims1\n\n    \n    \n    -34.8\n\n2\n\n    \n    \n    37.3\n    \n    \n    \"North America\"\n\nlonlims1\n\n    \n    \n    -131.3\n\n2\n\n    \n    \n    -64.8\n\nlatlims1\n\n    \n    \n    7.2\n\n2\n\n    \n    \n    63.6\n    \n    \n    \"Australia\"\n\nlonlims1\n\n    \n    \n    112.9\n\n2\n\n    \n    \n    153.6\n\nlatlims1\n\n    \n    \n    -43.6\n\n2\n\n    \n    \n    -10.7\n    \n    \n    \"South America\"\n\nlonlims1\n\n    \n    \n    -101.3\n\n2\n\n    \n    \n    -34.8\n\nlatlims1\n\n    \n    \n    -55.9\n\n2\n\n    \n    \n    12.5\n\n64.6 \u03bcs\n\n    \n    \n    FeatureCollection with 255 Features\n\n259 ms\n\n    \n    \n    make_ax_for_continent (generic function with 1 method)\n\n702 \u03bcs\n\n1.5 s\n\nUpon closer inspection of Asia, we can notice a significant number of\naddresses located in South Kora, (and possibly North Korea?), as well as in\nTaiwan. In Europe, most attacks are coming from the Netherlands and Germany.\n\n167 \u03bcs\n\n## Conclusion\n\n  * Initially I was shocked at the number of login attempts per day, especially in the context of the recent xz backdoor.\n\n    * I'll make extra sure to keep my system udpated with security updates, and to only make publicly accessible what's absolutely necessary.\n\n  * I was surpised to see that the distribution of attacks is extremely uneven with most of it concentrated in parts of Asia, Europe, and the US, and (almost) none from South America, Middle East, and Russia.\n\n  * Finally, Claude was a great help to do some bash wrangling and to suggest approaches to solve some problems quickly.\n\n417 \u03bcs\n\nFAQ\n\n", "frontpage": true}
