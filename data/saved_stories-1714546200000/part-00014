{"aid": "40216673", "title": "Pingora Restart Without Downtime", "url": "https://github.com/cloudflare/pingora/blob/main/docs/user_guide/graceful.md", "domain": "github.com/cloudflare", "votes": 1, "user": "kristianpaul", "posted_at": "2024-04-30 21:37:40", "comments": 0, "source_title": "pingora/docs/user_guide/graceful.md at main \u00b7 cloudflare/pingora", "source_text": "pingora/docs/user_guide/graceful.md at main \u00b7 cloudflare/pingora \u00b7 GitHub\n\nSkip to content\n\n## Navigation Menu\n\nSign in\n\n# Search code, repositories, users, issues, pull requests...\n\nSearch syntax tips\n\nSign in\n\nSign up\n\nYou signed in with another tab or window. Reload to refresh your session. You\nsigned out in another tab or window. Reload to refresh your session. You\nswitched accounts on another tab or window. Reload to refresh your session.\nDismiss alert\n\ncloudflare / pingora Public\n\n  * Notifications\n  * Fork 1.1k\n  * Star 19.4k\n\n/\n\n# graceful.md\n\n## Latest commit\n\nFix typos and grammar issues\n\nMar 1, 2024\n\n8160ad1 \u00b7 Mar 1, 2024Mar 1, 2024\n\n## History\n\nHistory\n\n19 lines (13 loc) \u00b7 1.34 KB\n\n/\n\n# graceful.md\n\n## File metadata and controls\n\n19 lines (13 loc) \u00b7 1.34 KB\n\nRaw\n\n# Graceful restart and shutdown\n\nGraceful restart, upgrade, and shutdown mechanisms are very commonly used to\navoid errors or downtime when releasing new versions of Pingora servers.\n\nPingora graceful upgrade mechanism guarantees the following:\n\n  * A request is guaranteed to be handled either by the old server instance or the new one. No request will see connection refused when trying to connect to the server endpoints.\n  * A request that can finish within the grace period is guaranteed not to be terminated.\n\n## How to graceful upgrade\n\n### Step 0\n\nConfigure the upgrade socket. The old and new server need to agree on the same\npath to this socket. See configuration manual for details.\n\n### Step 1\n\nStart the new instance with the --upgrade CLI option. The new instance will\nnot try to listen to the service endpoint right away. It will try to acquire\nthe listening socket from the old instance instead.\n\n### Step 2\n\nSend SIGQUIT signal to the old instance. The old instance will start to\ntransfer the listening socket to the new instance.\n\nOnce step 2 is successful, the new instance will start to handle new incoming\nconnections right away. Meanwhile, the old instance will enter its graceful\nshutdown mode. It waits a short period of time (to give the new instance time\nto initialize and prepare to handle traffic), after which it will not accept\nany new connections.\n\n## Footer\n\n\u00a9 2024 GitHub, Inc.\n\nYou can\u2019t perform that action at this time.\n\n", "frontpage": false}
