{"aid": "40158349", "title": "Revoking vulnerable Windows boot managers", "url": "https://techcommunity.microsoft.com/t5/windows-it-pro-blog/revoking-vulnerable-windows-boot-managers/ba-p/4121735", "domain": "microsoft.com", "votes": 1, "user": "skilled", "posted_at": "2024-04-25 14:56:19", "comments": 0, "source_title": "Revoking vulnerable Windows boot managers", "source_text": "Revoking vulnerable Windows boot managers | Windows IT Pro blog\n\nTurn on suggestions\n\nShowing results for\n\nShow only | Search instead for\n\nDid you mean:\n\n  * Back to Blog\n  * Newer Article\n  * Older Article\n\nRevoking vulnerable Windows boot managers\n\n  * Subscribe to RSS Feed\n  * Mark as New\n  * Mark as Read\n  * Bookmark\n  * Subscribe\n  * Printer Friendly Page\n  * Report Inappropriate Content\n\nBy\n\nSochi Ogbuanya\n\nPublished Apr 24 2024 10:00 AM 1,174 Views\n\nListen to the article\n\n00:0000:00\n\n00:00\n\nPowered by\n\nundefined\n\nSochiOgbuanya\n\nMicrosoft\n\nApr 24 2024 10:00 AM\n\n# Revoking vulnerable Windows boot managers\n\nApr 24 2024 10:00 AM\n\nIf you're worried about the BlackLotus UEFI bootkit vulnerability\n(CVE-2023-24932) and how it might affect your device's security, you'll be\npleased to learn about the measures Microsoft is taking to help keep you safe.\n\nBack in February, we shared steps you can take to prepare to update the Secure\nBoot trust anchors for Windows, as the existing ones are approaching expiry.\nWith the update to the Secure Boot trust anchor, we can address the threat of\nall previous, potentially vulnerable Windows boot components by revoking the\nold trust anchor. To this effect, the April 9 security updates includes a new\nSecure Boot revocation update. We refer to this update as the \"DBX update\" in\nthis article.\n\nIf you're interested in applying this revocation on systems with the updated\ntrust anchors, this article describes how to do just that. For now, we\nstrongly recommend the steps in this article for testing and validation only.\n\n## The security benefits of Secure Boot\n\nSecure Boot is a security feature in the Unified Extensible Firmware Interface\n(UEFI) that helps ensure that only trusted software runs during the system's\nboot sequence. We recommend the use of Secure Boot to help make a safe and\ntrusted path from UEFI through the Windows kernels' Trusted Boot sequence.\n\nAs an industry standard, UEFI's Secure Boot defines how platform firmware\nmanages certificates and authenticates firmware, and how the operating system\n(OS) interfaces with this process. For more details on UEFI and Secure Boot,\nrefer to the Secure Boot page.\n\nSecure Boot's main focus is to help protect the pre-boot environment from\nbootkit malware. A bootkit is a malicious program designed to load as early as\npossible in a device's boot sequence. Secure Boot helps ensure that only\nverified code executes before Windows. Verified code is firmware that runs\nearly in the boot sequence, initializes the PC prior to the launch of Windows\nOS, and is trusted based on certificates configured in the firmware. Examples\ninclude UEFI firmware drivers, bootloaders, applications, and option ROMs\n(Read-Only Memory). Disabling Secure Boot puts a device at high risk of\ninfection by bootkit malware.\n\n## Addressing the BlackLotus malware\n\nThe BlackLotus malware exploits a known security vulnerability called \u201cBaton\nDrop,\u201d tracked by CVE-2022-21894. It bypasses Secure Boot and then installs\nmalicious files to the EFI (Extensible Firmware Interface) System Partition\n(ESP), which are then launched by the UEFI firmware. Baton Drop allows\nrollback of Windows boot managers to previous vulnerable versions that are not\nin the Secure Boot Forbidden Signature Database (DBX). It then exploits the\nvulnerability in Windows boot manager as part of an attack. For more\ninformation, refer to Guidance for investigating attacks using CVE-2022-21894:\nThe BlackLotus campaign.\n\n### Windows boot manager mitigations that we released previously\n\nTo address this vulnerability, as part of the May 2023 servicing updates, we\nintroduced a code integrity policy that blocked vulnerable Windows boot\nmanagers based on their version number. For versions of Windows boot manager\nthat remained unaffected by this fix, we added them to the DBX.\n\nHowever, we have found multiple cases that can bypass the rollback protections\nreleased during the May 2023 servicing updates. As a result, we are putting\nforth a more comprehensive solution that involves revoking the Microsoft\nWindows Production PCA (Product Certificate Authority) 2011.\n\n### New measures to help secure Windows boot managers\n\nHere are the next steps to help protect against the malicious abuse of\nvulnerable Windows boot managers:\n\n  * What we're doing: As our current trust anchors are expiring in 2026, we're already migrating to new ones (catch up on this in KB5036210: Deploying Windows UEFI CA 2023 certificate to Secure Boot Allowed Signature Database). This transition allows us to revoke trust for the Windows signing certificate, Microsoft Windows Production PCA 2011. This Product Certificate authority (PCA) is currently used to authorize trust for all Windows boot managers in Secure Boot.\n  * What you can do: Once you've followed the steps in KB5036210 to add the new Windows trust anchor, you can follow the optional steps below to revoke trust in the Windows Production PCA 2011. Note that the earlier KB cautions that these updates should be done on \u201crepresentative sample test devices\u201d first. At this time, we strongly recommend the same cautious approach. Take the steps described in this article on \u201crepresentative sample test devices\u201d before attempting to perform these steps on production devices.\n\n## Guidelines for evaluating the Secure Boot DBX update\n\n### Understand the upcoming changes\n\nBy applying the DBX update to a secure boot enabled device, that device will\nno longer be able to boot from any Windows boot manager signed by the\nMicrosoft Windows Production PCA 2011. This includes booting through existing\nrecovery media, USB media, and network boot (WSD/PXE/HTTP) servers that do not\nhave updated boot manager components. PXE boot is especially likely to be\nimpacted. That's because you cannot update the binaries served by PXE until\nall machines supported by the network boot server are updated to run with the\nnew DB update.\n\n### Plan the deployment\n\nTo prepare your device to receive the DBX update package, ensure that you have\napplied the DB update package first and deployed the new updated boot manager\ncomponents signed by the Microsoft Windows UEFI CA 2023. Refer to KB5025885:\nHow to manage the Windows boot manager revocations for Secure Boot changes\nassociated wit... for more details.\n\n  1. Confirm that your device has successfully applied the DB update package first. Open a PowerShell console and ensure that PowerShell is running as an administrator before running the following command: [System.Text.Encoding]::ASCII.GetString((Get-SecureBootUEFI db).bytes) -match \u2018Windows UEFI CA 2023'\n\nScreenshot of a PowerShell console with a command string.\n\nIf the command returns \u201cTrue,\u201d the update was successful. In the case of\nerrors while applying the DB update, refer to the article, KB5016061:\nAddressing vulnerable and revoked Boot Managers.\n\n  2. After applying the April servicing updates, begin by testing the updates with individual devices. Test on the same firmware and specifications in the enterprise environment to minimize the risks in the case of firmware bugs in your devices.\n  3. Verify that your UEFI firmware version is the most recent available version by your firmware vendor or OEM.\n  4. For data backup steps, refer to this guide.\n  5. If you use BitLocker, or if your enterprise has deployed BitLocker on your machine, Back up your BitLocker recovery key. See this portal to ensure that your BitLocker keys are backed up before your next reboot for your selfhost device. In the unlikely event that device becomes inoperable after receiving the update, you can still unlock the hard drive.\n  6. For devices with third party full device or disk encryption, check with your disk encryption provider to perform your own set of tests before applying the update packages.\n  7. For detailed instructions on applying the DBX updates, refer to KB5025885: How to manage the Windows boot manager revocations for Secure Boot changes associated wit....\n\n### Why you need to update the DB before applying the DBX update\n\nNote: You cannot apply the DBX update package through Windows updates on a\ndevice without first applying the DB update.  \n---  \n  \nAs part of the planning for the DB and DBX update packages, Microsoft, in\ncollaboration with some of our OEM partners, has conducted extensive testing\non various device configurations to detect and resolve any bugs in firmware\nimplementations that could cause system failures or render a device\nunreceptive to these update packages. Despite our thorough testing, we\nacknowledge that we cannot cover every possible device configuration, so we\nstrongly recommend customers to perform their own tests on their devices\nbefore applying the DB and DBX update packages.\n\nSome of the associated risks with applying the DBX update package before\nupdating the DB update package include:\n\n  * The device firmware might encounter difficulties in processing the DB and DBX updates, leading to operational issues. In the handful of cases that we've encountered, we've notified the OEMs of the issue and blocked those devices from applying both DB and DBX updates until the issue can be remedied.\n  * While unlikely, you might inadvertently cause BitLocker to enter recovery and lose Virtualization-based Security (VBS) protected secrets that are used by Windows Hello or Credential Guard.\n  * Updating the PXE server to use 2023 signed binaries without applying the DB update first will cause the system to fail to boot, and inversely, applying the DBX update package will prevent any 2011 signed media from booting.\n\nDO NOT apply the DBX to a device without DB update through manual update,\nusing set-securebootuefi, as the system will not boot. Specifically, this will\nbypass the safety checks included in our servicing tool (Windows Updates) to\nguard against breaking issues. Update your device by relying on our published\nmitigations.\n\n## Continuing the journey of trust\n\nIn short, to establish new trust anchors, you need to untrust the Microsoft\nWindows Production PCA 2011. These updates are only a part of Microsoft's\nongoing dedication to security. Microsoft anticipates releasing DBX updates in\nthe future, with a goal of achieving mandatory enforcement no sooner than\nJanuary 2025. We encourage IT admins and enterprise customers to invest in\nbuilding workflows that ensure an efficient rollout of these updates across\ntheir device fleet.\n\nMake sure you're getting the most out of your security experience by checking\nout the following resources:\n\n  * KB5025885: How to manage the Windows boot manager revocations for Secure Boot changes associated wit...\n  * Guidance for investigating attacks using CVE-2022-21894: The BlackLotus campaign\n  * Updating Microsoft Secure Boot keys\n  * Azure Security best practices and pattern\n  * What are custom security attributes in Microsoft Entra ID?\n  * Secure the Windows boot process\n  * Windows operating system security\n\nContinue the conversation. Find best practices. Bookmark the Windows Tech\nCommunity, then follow us @MSWindowsITPro on X/Twitter. Looking for support?\nVisit Windows on Microsoft Q&A.\n\nSochi Ogbuanya\n\n0 Likes\n\nLike\n\nYou must be a registered user to add a comment. If you've already registered,\nsign in. Otherwise, register and sign in.\n\n  * Comment\n\nCo-Authors\n\nSochiOgbuanya\n\nVersion history\n\nLast update:\n\nApr 24 2024 02:51 PM\n\nUpdated by:\n\nSochiOgbuanya\n\nLabels\n\n## Share\n\n  * Share to LinkedIn\n  * Share to Facebook\n  * Share to Twitter\n  * Share to Reddit\n  * Share to Email\n\nSkip to Primary Navigation\n\nYour Privacy Choices\n\nAuto-suggest helps you quickly narrow down your search results by suggesting\npossible matches as you type.\n\nAuto-suggest helps you quickly narrow down your search results by suggesting\npossible matches as you type.\n\n", "frontpage": false}
