{"aid": "40275138", "title": "Why Your VPN May Not Be as Secure as It Claims", "url": "https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/", "domain": "krebsonsecurity.com", "votes": 1, "user": "feross", "posted_at": "2024-05-06 14:31:28", "comments": 0, "source_title": "Why Your VPN May Not Be As Secure As It Claims", "source_text": "Why Your VPN May Not Be As Secure As It Claims \u2013 Krebs on Security\n\nAdvertisement\n\nAdvertisement\n\n# Why Your VPN May Not Be As Secure As It Claims\n\nMay 6, 2024\n\n0 Comments\n\nVirtual private networking (VPN) companies market their services as a way to\nprevent anyone from snooping on your Internet usage. But new research suggests\nthis is a dangerous assumption when connecting to a VPN via an untrusted\nnetwork, because attackers on the same network could force a target\u2019s traffic\noff of the protection provided by their VPN without triggering any alerts to\nthe user.\n\nImage: Shutterstock.\n\nWhen a device initially tries to connect to a network, it broadcasts a message\nto the entire local network stating that it is requesting an Internet address.\nNormally, the only system on the network that notices this request and replies\nis the router responsible for managing the network to which the user is trying\nto connect.\n\nThe machine on a network responsible for fielding these requests is called a\nDynamic Host Configuration Protocol (DHCP) server, which will issue time-based\nleases for IP addresses. The DHCP server also takes care of setting a specific\nlocal address \u2014 known as an Internet gateway \u2014 that all connecting systems\nwill use as a primary route to the Web.\n\nVPNs work by creating a virtual network interface that serves as an encrypted\ntunnel for communications. But researchers at Leviathan Security say they\u2019ve\ndiscovered it\u2019s possible to abuse an obscure feature built into the DHCP\nprotocol so that other users on the local network are forced to connect to a\nrogue DHCP server.\n\n\u201cOur technique is to run a DHCP server on the same network as a targeted VPN\nuser and to also set our DHCP configuration to use itself as a gateway,\u201d\nLeviathan researchers Lizzie Moratti and Dani Cronce wrote. \u201cWhen the traffic\nhits our gateway, we use traffic forwarding rules on the DHCP server to pass\ntraffic through to a legitimate gateway while we snoop on it.\u201d\n\nThe feature being abused here is known as DHCP option 121, and it allows a\nDHCP server to set a route on the VPN user\u2019s system that is more specific than\nthose used by most VPNs. Abusing this option, Leviathan found, effectively\ngives an attacker on the local network the ability to set up routing rules\nthat have a higher priority than the routes for the virtual network interface\nthat the target\u2019s VPN creates.\n\n\u201cPushing a route also means that the network traffic will be sent over the\nsame interface as the DHCP server instead of the virtual network interface,\u201d\nthe Leviathan researchers said. \u201cThis is intended functionality that isn\u2019t\nclearly stated in the RFC [standard]. Therefore, for the routes we push, it is\nnever encrypted by the VPN\u2019s virtual interface but instead transmitted by the\nnetwork interface that is talking to the DHCP server. As an attacker, we can\nselect which IP addresses go over the tunnel and which addresses go over the\nnetwork interface talking to our DHCP server.\u201d\n\nLeviathan found they could force VPNs on the local network that already had a\nconnection to arbitrarily request a new one. In this well-documented tactic,\nknown as a DHCP starvation attack, an attacker floods the DHCP server with\nrequests that consume all available IP addresses that can be allocated. Once\nthe network\u2019s legitimate DHCP server is completely tied up, the attacker can\nthen have their rogue DHCP server respond to all pending requests.\n\n\u201cThis technique can also be used against an already established VPN connection\nonce the VPN user\u2019s host needs to renew a lease from our DHCP server,\u201d the\nresearchers wrote. \u201cWe can artificially create that scenario by setting a\nshort lease time in the DHCP lease, so the user updates their routing table\nmore frequently. In addition, the VPN control channel is still intact because\nit already uses the physical interface for its communication. In our testing,\nthe VPN always continued to report as connected, and the kill switch was never\nengaged to drop our VPN connection.\u201d\n\nThe researchers say their methods could be used by an attacker who compromises\na DHCP server or wireless access point, or by a rogue network administrator\nwho owns the infrastructure themselves and maliciously configures it.\nAlternatively, an attacker could set up an \u201cevil twin\u201d wireless hotspot that\nmimics the signal broadcast by a legitimate provider.\n\n## ANALYSIS\n\nBill Woodcock is executive director at Packet Clearing House, a nonprofit\nbased in San Francisco. Woodcock said Option 121 has been included in the DHCP\nstandard since 2002, which means the attack described by Leviathan has\ntechnically been possible for the last 22 years.\n\n\u201cThey\u2019re realizing now that this can be used to circumvent a VPN in a way\nthat\u2019s really problematic, and they\u2019re right,\u201d Woodcock said.\n\nWoodcock said anyone who might be a target of spear phishing attacks should be\nvery concerned about using VPNs on an untrusted network.\n\n\u201cAnyone who is in a position of authority or maybe even someone who is just a\nhigh net worth individual, those are all very reasonable targets of this\nattack,\u201d he said. \u201cIf I were trying to do an attack against someone at a\nrelatively high security company and I knew where they typically get their\ncoffee or sandwich at twice a week, this is a very effective tool in that\ntoolbox. I\u2019d be a little surprised if it wasn\u2019t already being exploited in\nthat way, because again this isn\u2019t rocket science. It\u2019s just thinking a little\noutside the box.\u201d\n\nSuccessfully executing this attack on a network likely would not allow an\nattacker to see all of a target\u2019s traffic or browsing activity. That\u2019s because\nfor the vast majority of the websites visited by the target, the content is\nencrypted (the site\u2019s address begins with https://). However, an attacker\nwould still be able to see the metadata \u2014 such as the source and destination\naddresses \u2014 of any traffic flowing by.\n\nKrebsOnSecurity shared Leviathan\u2019s research with John Kristoff, founder of\ndataplane.org and a PhD candidate in computer science at the University of\nIllinois Chicago. Kristoff said practically all user-edge network gear,\nincluding WiFi deployments, support some form of rogue DHCP server detection\nand mitigation, but that it\u2019s unclear how widely deployed those protections\nare in real-world environments.\n\n\u201cHowever, and I think this is a key point to emphasize, an untrusted network\nis an untrusted network, which is why you\u2019re usually employing the VPN in the\nfirst place,\u201d Kristoff said. \u201cIf local network is inherently hostile and has\nno qualms about operating a rogue DHCP server, then this is a sneaky technique\nthat could be used to de-cloak some traffic \u2013 and if done carefully, I\u2019m sure\na user might never notice.\u201d\n\n## MITIGATIONS\n\nAccording to Leviathan, there are several ways to minimize the threat from\nrogue DHCP servers on an unsecured network. One is using a device powered by\nthe Android operating system, which apparently ignores DHCP option 121.\n\nRelying on a temporary wireless hotspot controlled by a cellular device you\nown also effectively blocks this attack.\n\n\u201cThey create a password-locked LAN with automatic network address\ntranslation,\u201d the researchers wrote of cellular hot-spots. \u201cBecause this\nnetwork is completely controlled by the cellular device and requires a\npassword, an attacker should not have local network access.\u201d\n\nLeviathan\u2019s Moratti said another mitigation is to run your VPN from inside of\na virtual machine (VM) \u2014 like Parallels, VMware or VirtualBox. VPNs run inside\nof a VM are not vulnerable to this attack, Moratti said, provided they are not\nrun in \u201cbridged mode,\u201d which causes the VM to replicate another node on the\nnetwork.\n\nIn addition, a technology called \u201cdeep packet inspection\u201d can be used to deny\nall in- and outbound traffic from the physical interface except for the DHCP\nand the VPN server. However, Leviathan says this approach opens up a potential\n\u201cside channel\u201d attack that could be used to determine the destination of\ntraffic.\n\n\u201cThis could be theoretically done by performing traffic analysis on the volume\na target user sends when the attacker\u2019s routes are installed compared to the\nbaseline,\u201d they wrote. \u201cIn addition, this selective denial-of-service is\nunique as it could be used to censor specific resources that an attacker\ndoesn\u2019t want a target user to connect to even while they are using the VPN.\u201d\n\nMoratti said Leviathan\u2019s research shows that many VPN providers are currently\nmaking promises to their customers that their technology can\u2019t keep.\n\n\u201cVPNs weren\u2019t designed to keep you more secure on your local network, but to\nkeep your traffic more secure on the Internet,\u201d Moratti said. \u201cWhen you start\nmaking assurances that your product protects people from seeing your traffic,\nthere\u2019s an assurance or promise that can\u2019t be met.\u201d\n\nA copy of Leviathan\u2019s research, along with code intended to allow others to\nduplicate their findings in a lab environment, is available here.\n\nThis entry was posted on Monday 6th of May 2024 10:24 AM\n\nA Little Sunshine Latest Warnings The Coming Storm Web Fraud 2.0\n\nBill Woodcock Dani Cronce DHCP option 121 DHCP starvation attack Dynamic Host\nControl Protocol John Kristoff Leviathan Security Lizzie Moratti Packet\nClearing House\n\n### Leave a Reply Cancel reply\n\nAdvertisement\n\nAdvertisement\n\nMailing List\n\nSubscribe here\n\nSearch KrebsOnSecurity\n\nRecent Posts\n\n  * Why Your VPN May Not Be As Secure As It Claims\n  * Man Who Mass-Extorted Psychotherapy Patients Gets Six Years\n  * FCC Fines Major U.S. Wireless Carriers for Selling Customer Location Data\n  * Russian FSB Counterintelligence Chief Gets 9 Years in Cybercrime Bribery Scheme\n  * Who Stole 3.6M Tax Records from South Carolina?\n\nStory Categories\n\n  * A Little Sunshine\n  * All About Skimmers\n  * Ashley Madison breach\n  * Breadcrumbs\n  * Data Breaches\n  * DDoS-for-Hire\n  * Employment Fraud\n  * How to Break Into Security\n  * Internet of Things (IoT)\n  * Latest Warnings\n  * Ne'er-Do-Well News\n  * Other\n  * Pharma Wars\n  * Ransomware\n  * Russia's War on Ukraine\n  * Security Tools\n  * SIM Swapping\n  * Spam Nation\n  * Target: Small Businesses\n  * Tax Refund Fraud\n  * The Coming Storm\n  * Time to Patch\n  * Web Fraud 2.0\n\nWhy So Many Top Hackers Hail from Russia\n\n\u00a9 Krebs on Security - Mastodon\n\n", "frontpage": false}
