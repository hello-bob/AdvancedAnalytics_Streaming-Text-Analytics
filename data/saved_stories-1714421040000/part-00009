{"aid": "40196273", "title": "IPv6 Prefix Lengths", "url": "https://www.potaroo.net/ispcol/2024-04/ipv6-prefixes.html", "domain": "potaroo.net", "votes": 2, "user": "skilled", "posted_at": "2024-04-29 09:26:36", "comments": 0, "source_title": "ISP Column - April 2024", "source_text": "ISP Column - April 2024\n\nThe ISP ColumnA column on things Internet  \n---  \nOther Formats:  \n  \nIPv6 Prefix Lengths April 2024\n\nGeoff Huston, Nathan Ward\n\nThe topic of address plans for IPv6 has had a rich and varied history. From\nthe very early concepts of \u201cit\u2019s just like IPv4, only with a 128-bit address\nfield\u201d, through the models of \u201cAggregation Identifiers\u201d and the hierarchy of\n\u201cTop-Level,\u201d \u201cNext-Level\u201d and \u201cSite-Level\u201d defined in RFC 2373 from July 1998\nand then the simplified adoption of a /48 Site-Level prefix in RFC 3177 from\nSeptember 2001 to the address plan of RFC 6177 from March 2011, which eschews\nas far as possible the use of fixed boundaries in the address plan.\n\nWhat we have today is a single \u201cboundary\u201d in the IPv6 address plan, where the\nlow order 64 bits are locally assigned as an interface identifier, and the\nhigh order 64 bits are in essence a network identifier, where the boundary\nbetween what constitutes locally defined site networks and globally visible\nnetworks is left to each network operator.\n\nThe concept behind this 64-bit interface identifier was the idea that all\nhosts would maintain a constant 64-bit interface identifier irrespective of\nwhere and when the host attached to a public network. In theory a site could\nmaintain locally connectivity based only on these 64-bit values, irrespective\nof the site\u2019s external connectivity. This was supposed to aid in sites\nimproving their resiliency through having an option for multiple external\nconnections and allow disconnected sites to still operate.\n\nAs subsequently pointed out in RFC 4941, this represented a significant issue\nfor user privacy, allowing an external observer to correlate multiple\nappearances of the same mobile host on multiple access networks over time.\nThis RFC recommended that IPv6 hosts use a random IPv6 Interface Identifier,\nand regularly change its value. The effective result is that for almost all\nIPv6 hosts (some 96.15% of IPv6 hosts as seen in APNIC Lab\u2019s IPv6 measurement\nprogram) use these random interface identifiers in place of a static 64-bit\ninterface identifier for public communications.\n\nThe question is why do we persist with this 64/64 bit boundary in the IPv6\naddress architecture between the network and the host identifier? Why did we\nnot just go all the way and emulate IPv4\u2019s address architecture and allow the\nnetwork operator to select their own address length for the network? I have no\nrational answer to this question. I\u2019m left with the observation that IPv6 is\nnot in fact a 128-bit address protocol in the same way as IPv4 is a 32-bit\naddress protocol. It\u2019s a \u201c64-bits plus a few extra interface identifier bits\u201d\naddress protocol.\n\nWhile the concepts of the fixed length \u201cTop Level\u201d and \u201cNext Level\u201d aggregator\naddress fields were quickly discarded, the \u201cSite Prefix\u201d has persisted in the\nIPv6 address architecture, but instead of being a fixed 48-bit value, it\u2019s now\na variable length value, which the length determined by each individual\nnetwork operator, or their IPv6 technology provider.\n\nThis leads to the question: What lengths are commonly used by network\noperators to assign Site Prefixes to each customer?\n\nUnless you are located within the network and can observe the length of the\nIPv6 address prefix that your provider has assigned to you, this is not an\neasy question to answer. But if we can assemble a collection of IPv6 addresses\nused in the public Internet, then we can examine the address to make a\nreasonable estimate of the site prefix length being used.\n\nFor each IPv6 address:\n\n  * If bits 48 to 63 are all zero then assume a /48 site prefix, and the site is using subnet 0.\n\n  * If any bits between 48 and 55 are one, and bits 56 through 63 are all zero, we assume a /56 prefix.\n\n  * If any bits between 48 and 59 are one, and bits 60 through 63 all being zero, we assume a /60 prefix.\n\n  * If we see any bits between 48 and 64, we assume a /64 prefix.\n\n  * For prefix lengths 48, 56, and 60, if bit 64 is 1, we assume the address is from a second subnet within the ISP assigned prefix.\n\nThis exercise of deriving site prefix lengths from IPv6 source addresses was\nfirst conducted by Nathan Ward using a small data set of 936 IPv6 host\naddresses. The results of that analysis can be found here. He estimated that\n0.01% of these IPv6 addresses used a /48 prefix length, 21% used a /56, 22%\nused a /60 and 55% of these addresses used a /64 prefix length.\n\nThe obvious question is: Does this distribution of values hold when using a\nsignificantly larger collection of IPv6 source addresses?\n\nThe APNIC Labs ad-based IPv6 measurement platform, collects some 7M \u2013 8M\nunique IPv6 source addresses per day. These are typically the IPv6 addresses\nof end user systems who received an ad impression (although there is a small\nlevel of exceptions when a VPN is in use, or when obscuring technology, such\nas Apple Private Data Relay service, is being used).\n\n### IPv6 Subnet Use\n\nWe\u2019ve applied this subnet classification algorithm to these IPv6 host\naddresses on a day-by-day basis since the start of 2022. The result is shown\nin Figure 1.\n\nFigure 1 \u2013 IPv6 Site Prefix Length Estimation - 2022 - present\n\nThe results from this exercise show that the current breakdown of subnet\nprefix sizes in the APNIC Labs data set is consistent with the results from\nthe smaller data set used by Nathan Ward. The /64 subnet is the most common\nsubnet size, used in 57% of cases in recent data. The /60 and /56 subnets are\nseen in 21% and 20% of cases respectively. Finally, the /48 subnet is seen in\n2% of cases.\n\nOver the past 28 months there has been some changes in this distribution,\nwhere the relative use of /64 prefixes have dropped from 72% to 57%, while the\nrelative incidence of /56 subnets has risen by 10% over this period. There was\na small relative increase in /60 subnets of 5% while the relative use of /48\nsubnets have remained constant.\n\nThis data indicates that few ISPs assign end sites a /48 prefix. A possible\nexplanation of this distribution of subnet sizes is that the use of a /64\nprefix is prevalent in mobile services, where individual devices are assigned\na /64 prefix by the mobile service provider, while the use of a /60 and /56\nappears to have become the default setting in broadband deployments in this\ndata.\n\nIt may well be the case that /48 prefixes are used more commonly in enterprise\ncontexts, and the penetration of IPv6 into enterprise environments has been\nfar slower than the deployment in mass market public IP services in mobile and\nbroadband.\n\n### Internal Subnet Structure?\n\nPrefix lengths of 63 bits or smaller allow a site to operate an internal\nsubnet structure. The question is: How often are multiple subnets used by end\nsites?\n\nAgain, this is not an easy question to answer by direct measurement, as this\ninternal structure is only visible to an observer located within the end site.\nHowever, there is a way to make a rough estimate, and that is by looking for\nthe relative incidence of subnet \u201c1\u201d in visible host addresses. This assumes\nthat most site administrators will number site-local subnets using sequential\nnumbering of 0,1,2 and so on. The presence of subnet 1 in an address, as per\nthe decision algorithm described above, may be an indicator of the use of\nmultiple subnets within a site.\n\nThe relative occurrence of subnet 1 in each of the /48, /56 and /60 site\nprefixes are shown in Figure 2.\n\nFigure 2 \u2013 Subnet 1 occurrence - 2022 - present\n\nThis data indicates that multiple subnets may be common in /48 prefixes\n(~45%), but less so for /56 (10%) and /60 prefixes (20%). This data is\nconsistent with the supposition of /48 prefixes are more commonly used in\nenterprise scenarios, where multiple subnets are more likely to be used.\n\n### Measurement by /48s\n\nIt can be argued that the outcome shown in Figure 1, namely that /64s are the\nmost common, is influenced by the observation that there are many more /64\nprefixes than /48 prefixes. We can attempt to compensate for this by using a\nuniform /48 division in the IPv6 address plan. For each observed source IPv6\naddress, we use the classification algorithm, to derive a likely subnet size,\nbut we then use the encompassing /48 address prefix, and assign this subnet\nsize to the /48 subnet. When we get multiple subnets of different sizes in the\nsame /48 well use the longer subnet (i.e. if we observe both a /48 and a /60\nin a common /48 prefix then we\u2019ll use the /60 value).\n\nThe result of this analysis is shown in Figure 3.\n\nFigure 3 \u2013 Proportion of subnets per encompassing /48 prefix\n\nComparing this result to that shown in Figure 1 we see than the most common\nsubnet size, when looking at the IPv6 space as a set of /48 prefixes, is a\n/56. While there are a large set of IPv6 source addresses that map to a /64\nsubnet, they all come from a smaller set of common /48 prefixes.\n\n### RIR Allocations\n\nIt\u2019s not clear that a /48 \u201cparent\u201d prefix is the most appropriate one to use\nhere. Alternatively, we could make an assumption that each network uses a\nuniform subnet address plan, and furthermore assume that each IPv6 address\nallocation from a Regional Internet Registry (RIR) corresponds to an\nindividual network.\n\nFigure 4 \u2013 Proportion of subnets per encompassing RIR address allocation\n\nThis perspective of subnet use is similar to Figure 3, where the use of /64\nand /56 subnets are the most prevalent, while /60 and /48 subnet are far less\ncommon.\n\n### Anomalies\n\nThis exercise is based on the assumption that where subnetting is being used\nwithin an end site, the initial subnet, subnet 0, is the most likely to be\nused.\n\nThis is not necessarily the case. For example, Starlink assigns each end user\na /56. The default subnet identifier, seen in 15,309 cases out of 16,711 in\none recent day from this data set, uses subnet number 16 (hex 10) as the\ndefault on-site network, causing this algorithm to incorrectly assume that a\n/60 is being used for Starlink address assignments.\n\nIt appears that, at best, this approach offers an approximate view of IPv6\naddress assignment and subnet behaviours in the IPv6 network.\n\n### The role of Subnets in a Network Architecture\n\nWhy use subnets at all? The standard response is that \u201csubnets make networks\nmore efficient\u201d by localising traffic. A subnet encompasses an internally\nself-connected region of a network. Traffic between the attached nodes within\na subnet can be handled by the routers within that subnet. Subnets can\nsimplify the network routing architecture, in that routers within a distinct\nsubnet need only maintain routes for the hosts that are located within the\nsubnet, and a \u201cdefault\u201d router pointing to the network beyond the subnet can\nbe used for all other hosts. If all the hosts in a subnet are addressed from a\ncommon address prefix then the external network that hosts the subnet need\nonly maintain a single route to this common address prefix, delegating the\ndetails of individual host reachability to the routers within the subnet. All\nof this is explained in detail in RFC 950.\n\nThe entire concept of nested hierarchies of subnets is an intrinsic part of\nthe IPv4 architecture, particularly so when the address architecture was\nmigrated from the old Class A, B and C network/host fixed boundaries to a\nclassless address architecture where every subnet was essentially defined by a\ncommon address prefix and a prefix length.\n\nIt\u2019s an interesting question to ask to what extent this address architecture\nis an intrinsic part of today\u2019s network designs. In the IPv4 environment the\ndepleted IPv4 address pools have meant that for many networks at the edge the\nconventional subnet boundaries have been replaced by network address\ntranslation boundaries. In the IPv6 environment a subnet still appears to have\nsome traction, but its closer to a IPv6 Neighbor Discovery realm where the\nconcept of \u201clocality\u201d is defined by virtue of a membership of a common\nmulticast realm. In a networking world where the capabilities of layer-2\nswitching environments have all but supplanted the former role of direct\nphysical connectivity the answer to a simple question of \u201care we connected to\neach other?\u201d is sometimes deceptively complex.\n\nAs an abstraction to assist in scaling the networks, subnets still have a role\nto play, but as the pendulum of the technology of packet networking swings\nback from routing to switching, its increasingly challenging to understand\nexactly what this role is!\n\n### Disclaimer\n\nThe above views do not necessarily represent the views of the Asia Pacific\nNetwork Information Centre.\n\nGEOFF HUSTON AM, B.Sc., M.Sc., is the Chief Scientist at APNIC, the Regional\nInternet Registry serving the Asia Pacific region.\n\nwww.potaroo.net\n\n", "frontpage": false}
