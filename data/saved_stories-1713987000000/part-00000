{"aid": "40144135", "title": "QEMU 9.0 Released", "url": "https://wiki.qemu.org/ChangeLog/9.0", "domain": "qemu.org", "votes": 5, "user": "LaSombra", "posted_at": "2024-04-24 13:27:31", "comments": 0, "source_title": "ChangeLog/9.0", "source_text": "ChangeLog/9.0 - QEMU\n\nJump to content\n\nSearch\n\n# ChangeLog/9.0\n\nFrom QEMU\n\n## System emulation\n\n### Removed features and incompatible changes\n\nConsult the 'Removed features' page for details of suggested replacement\nfunctionality.\n\n  * Running QEMU with KVM requires Linux 4.4 or newer. A future version of QEMU will increase the minimum requirement for Arm hosts to Linux 4.19 (also when running KVM); if this is too restrictive for your use case, please contact us at qemu-devel@nongnu.org.\n  * The behaviour of the '-serial none' option when used together with other '-serial' options has been corrected. Previously when '-serial none' was followed by '-serial something' the '-serial none' was effectively ignored. Now it controls the existence of the first serial port, and the following '-serial' option controls the behaviour of the second serial port; this brings it in to line with how all other cases of multiple '-serial' options work. If you have a command line that was accidentally relying on the old behaviour, you can simply delete the unnecessary '-serial none'.\n\n### New deprecated options and features\n\nConsult the \"Deprecated Features\" chapter of the QEMU System Emulation User's\nGuide for further details of the deprecations and their suggested\nreplacements.\n\n  * The CRIS architecture has been marked deprecated\n  * Arm boards akita, borzoi, cheetah, connex, mainstone, n800, n810, spitz, terrier, tosa, verdex, z2 have been deprecated\n\n### 68k\n\n  * Fixed exception frame format for 68010\n\n  * Add nubus-virtio-mmio device to allow the q800 machine to access virtio devices\n\n### Alpha\n\n### Arm\n\n  * Some board types modelling old Arm hardware using the PXA2xx and OMAP2 SoCs have been deprecated and are scheduled for removal in a future QEMU release: akita, borzoi, cheetah, connex, mainstone, n800, n810, spitz, terrier, tosa, verdex, z2. The code implementing these boards was very old and unmaintained, and we don't believe that any of them have a large number of users.\n\n  * New architectural features now emulated:\n\n    * FEAT_ECV (Enhanced Counter Virtualization)\n    * FEAT_NV (Nested Virtualization)\n    * FEAT_NV2 (Enhanced nested virtualization support)\n\n  * New board types:\n\n    * b-l475e-iot01a : the B-L475E-IOT01A board (currently minimal support only)\n    * mps3-an536 : a Cortex-R52 board modelling the AN536 firmware image for the MPS3 development board\n    * raspi4b : the Raspberry Pi 4 Model B. Note that QEMU does not yet model PCI or ethernet; we hope to implement those devices for the next QEMU release.\n\n  * Changes to existing board types:\n\n    * The Freescale i.MX6 now models the cache controller and the PCIe controller\n    * The Allwinner R40 and Bananapi boards now model the USB controllers, the AHCI/SATA controller and the watchdog timer\n    * Raspberry Pi boards now support the SPI controller and the BSC i2c controller\n    * The npcm7xx based boards now support the ethernet controllers\n    * The virt board now wires up non-secure EL2 virtual timer IRQ when EL2 emulation is enabled with 'virtualization=on'.\n\nNote that when the virt board uses the non-secure EL2 virtual timer IRQ, this\nwill trip a bug in older versions of the EDK2 guest firmware, which causes\nEDK2 to assert on bootup with \"ASSERT [ArmTimerDxe]\n/home/kraxel/projects/qemu/roms/edk2/ArmVirtPkg/Library/ArmVirtTimerFdtClientLib/ArmVirtTimerFdtClientLib.c(72):\nPropSize == 36 || PropSize == 48\". If you see that assertion you should do one\nof:\n\n  * update your EDK2 binaries to edk2-stable202311 or newer\n  * use the 'virt-8.2' versioned machine type\n  * not use 'virtualization=on'\n\n### AVR\n\n### Hexagon\n\n### HPPA\n\n  * SeaBIOS-hppa version 16\n  * SeaBIOS now provided as 64-bit and 32-bit binary\n  * Fixed 32-bit HP-UX crashes on B160L (32-bit) machine\n  * Fixed random SCSI slowdowns and script aborts on HP-UX 10.20, Linux and NetBSD\n  * Fixed NetBSD boot failure due to power button in page zero\n  * Fixed NetBSD FPU detection failure\n  * Fixed NetBSD networking with tulip driver\n  * Fixed OpenBSD 7.4 boot failure\n  * Allows up to 3840 MB of memory (instead of 3.0 GB)\n  * Supports the qemu --nodefaults option\n  * Added qemu-specific opcodes for \"HALT QEMU\", \"RESET QEMU\" and \"RESTORE SHR\" (restore shadow registers).\n  * Does not abort on access failure in Astro/Elroy registers\n\n### LoongArch\n\n#### ISA and Extensions\n\n  * Add loongarch kvm accel support\n  * KVM: Enable LSX/LASX extension\n  * Fix tlb huge page loading issue\n  * Set vector registers call clobbered\n  * Set cpuid CSR register only once with kvm mode\n\n#### Machines\n\n  * Change the UEFI loading mode to loongarch\n  * Add dynamic cpu number support for loongarch_extioi\n  * Fix qtest test-hmp error when KVM-only build\n  * Fix qemu-system-loongarch64 assert failed with the option '-d int'\n  * Fix interrupt routing update\n\n### Microblaze\n\n### MIPS\n\n### Nios2\n\n  * A bug was fixed in nios2-linux-user that meant async work was being skipped\n\n### OpenRISC\n\n### PowerPC\n\n### Renesas RX\n\n### Renesas SH\n\n#### ISA and Extensions\n\n  * Fix mac.w memory load operand size\n  * Fix mac.w behavior in saturation arithmetic mode\n  * Fix mac.l behavior in saturation arithmetic mode\n  * Fix delay slot restrictions for PC-relative mov.w, mov.l, mova\n\n### RISC-V\n\n#### ISA and Extensions\n\n  * Add support for Zacas extension\n  * Add amocas.[w,d,q] instructions\n  * RVA22 profiles support\n  * Add RVV CSRs to KVM\n  * Add support for 'B' extension\n  * Implement optional CSR mcontext of debug Sdtrig extension\n  * Add support for Zaamo and Zalrsc\n  * Enable xtheadsync under user mode\n  * Add Ztso extension\n  * Use 'zfa' instead of 'Zfa'\n  * move ratified/frozen exts to non-experimental\n\n#### Machines\n\n  * ACPI: Enable AIA, PLIC and update RHCT\n  * Fix the interrupts-extended property format of PLIC\n  * Document acpi parameter of virt machine\n  * Remove group setting of KVM AIA if the machine only has 1 socket\n  * sifive_u: Update S-mode U-Boot image build instructions\n  * Support vlenb and vregs[] in KVM\n  * Support new isa extension detection devicetree properties\n  * SMBIOS support for RISC-V virt machine\n  * Add rv32i,rv32e and rv64e CPUs\n  * Enable SPCR for SCPI virt machine\n  * Add SRAT and SLIT ACPI tables\n  * Update KVM exts to Linux 6.8\n\n#### Fixes and Misc\n\n  * Fix th.dcache.cval1 priviledge check\n  * Don't allow write mstatus_vs without RVV\n  * Fix machine IDs QOM getters\n  * Fix KVM reg id sizes\n  * Upgrade OpenSBI from v1.3.1 to v1.4\n  * pmp: Ignore writes when RW=01 and MML=0\n  * Don't adjust vscause for exceptions\n  * Ensure mideleg is set correctly on reset\n  * Check for 'A' extension on all atomic instructions\n  * Allow large kernels to boot by moving the initrd further away in RAM\n  * FIX xATP_MODE validation\n  * Ensure mcountinhibit, mcounteren, scounteren, hcounteren are 32-bit\n  * Fix vector shift count overflow\n  * Fix setipnum_le write emulation for APLIC MSI-mode\n  * Fix in_clrip[x] read emulation\n  * Fix privilege mode of G-stage translation for debugging\n  * Fix ACPI MCFG table for virt machine\n  * A range of Vector fixes\n  * Update APLIC IDC after claiming iforce register\n  * Fix timebase-frequency when using KVM acceleration\n\n### s390x\n\n  * Fix access register handling in the emulation of the LOAD ADDRESS EXTENDED (LAE) instruction\n  * Add emulation of CVDG, CVB, CVBY and CVBG instructions\n\n### SPARC\n\n### Tricore\n\n### x86\n\n#### Xen emulation under KVM\n\n#### TCG\n\n#### Known issues\n\n### Xtensa\n\n### Device emulation and assignment\n\n#### ACPI / SMBIOS\n\n#### Audio\n\n#### Block devices\n\n  * The 'virtio-blk' device has gained true multiqueue support where different queues of a single disk can be processed by different I/O threads. This can improve scalability in cases where the guest submitted enough I/O to saturate the host CPU running a single I/O thread processing the virtio-blk requests. Multiple I/O threads can be configured using the new 'iothread-vq-mapping' property.\n  * 'usb-storage' doesn't ignore the properties 'backend_defaults', 'logical_block_size', 'physical_block_size', 'min_io_size', 'opt_io_size' and 'discard_granularity' any more.\n  * Fixed 'vhost-vdpa-device' to be compatible with VDUSE block exports again (this was broken in QEMU 8.2.0)\n\n#### Graphics\n\n#### Hyper-V\n\n#### I2C\n\n#### Input devices\n\n#### IPMI\n\n#### Multi-process QEMU\n\n#### Network devices\n\n#### NVDIMM\n\n#### NVMe\n\n#### PCI/PCIe\n\n#### SCSI\n\n  * The ESP SCSI (am53c974/dc390) device has been substantially rewritten, fixing several long-standing bugs and making it easier to maintain in future.\n\n#### SD card\n\n#### SMBIOS\n\n#### TPM\n\n#### UFS\n\n#### USB\n\n#### VFIO\n\n  * Introduced an IOMMU interface backend for VFIO devices\n  * Introduced a new IOMMUFD backend for ARM, x86_64 and s390x platforms\n  * Better error reporting\n  * Allowed cpr-reboot for VFIO devices\n  * Misc fixes\n\n#### virtio\n\n#### vDPA\n\n#### Xen\n\n#### fw_cfg\n\n#### 9pfs\n\n#### virtiofs\n\n#### Semihosting\n\n### Audio\n\n### Character devices\n\n  * Fix potential crash if connection is dropped while the TLS handshake is still in progress\n  * Fix I/O on TLS channels when chardev frontend is not ready to consume data\n  * QEMU is more likely to process pending incoming data before processing EOF/HUP\n\n### Crypto subsystem\n\n  * The 'sm4' cipher algorithm is now supported and can be used with the 'luks' block driver\n  * The cipher test suite will automatically skip testing algorithms that have been disabled in the underlying OS crypto library at build time.\n\n### Authorization subsystem\n\n### GUI\n\n### GDBStub\n\n  * the gdbstub now supports catching syscalls in user-mode\n  * the gdbstub now supports fork-follow modes\n  * the gsbstub now supports siginfo:read\n\n### TCG Plugins\n\n  * vcpu_init callback will now always be in the vcpu context\n  * A new API for accessing register values is now available (and used by execlog)\n  * The inline API has been replaced with a thread safe scoreboard indexed by vcpu_index\n\n### Host support\n\n### Memory backends\n\n  * Memory backends specified on the QEMU commandline can now be preallocated concurrently/asynchronously in some configurations, to speedup QEMU startup with preallocation on multiple memory backends: one requirement is that memory backends that are getting preallocated have a \"thread-context\" set.\n  * QEMU 8.2 accidentally allowed for creation of memory backends with sizes that are not aligned to the (huge) page size. This has been fixed.\n\n### Migration\n\n  * Fixed migration for SUSPENDED VM, where we used to ignore the SUSPENDED state and kick off the VM even if it was suspended before the migration.\n  * New capability called \"mapped-ram\". It allows efficient VM snapshots save/load by providing both (1) constant size of ultimate VM image rather than unlimited, and (2) multi-threading support so that save/load of snapshots can be faster.\n  * Zero page detection offloading for multifd, so that idle guest migration should get a major boost when multifd is enabled.\n  * New parameter called \"zero-page-detection\", allow the user to choose the policy for detecting zero pages.\n  * Enhancement to CPR-reboot mode, added VFIO supports (requires guest suspensions), new documents.\n  * Fixed a rare postcopy hang with preempt mode since 8.2\n\n### Monitor\n\n#### QMP\n\n  * Fixed a race condition where monitor commands could be executed unexpectedly in the middle of another operation and caused crashes\n\n#### HMP\n\n### Network\n\n### Block device backends and tools\n\n  * The block layer is now thread safe and multiple I/O threads can send I/O requests to the same disk image. virtio-blk can be configured to make use of this and improve scalability (see above).\n  * The 'luks' block driver now supports creation and usage of detached LUKS header files\n  * The 'stream' and 'commit' block jobs have a new flag 'backing-mask-protocol'. If it is enabled and the base backing file uses a protocol driver (like 'file') directly, 'raw' is stored as the backing file format in the overlay instead of the protocol name.\n  * In 'blklogwrites', potential log corruption bugs were fixed related to concurrent requests and to write zeroes operations\n  * Fixed I/O errors in the libblkio based block drivers caused by incorrect memory alignment of bounce buffers\n  * Fixed deadlocks that could hang the whole QEMU process in the mirror block job and the NBD export\n\n### Tracing\n\n### Semihosting\n\n### Miscellaneous\n\n  * During startup QEMU system emulators will raise the max file descriptors soft limit to match the hard limit\n  * Seccomp filters will now return EPERM rather than killing QEMU if code attempts to spawn a child process. Fixes compatibility with some NVIDIA libraries which try to run modprobe.\n  * Thread-local coroutine pools have been mostly replaced by a global pool, which reduces the number of inactive coroutines (and therefore memory mappings) and is limited to a maximum size depending on vm.max_map_count on Linux. This fixes the \"failed to set up stack guard page\" error that has been reported on Linux hosts where the QEMU coroutine pool exceeded the vm.max_map_count limit.\n\n## User-mode emulation\n\n### runtime\n\n### binfmt_misc\n\n### alpha\n\n### arm/arm64/aarch64\n\n### LoongArch\n\n### HPPA\n\n### s390\n\n### x86\n\n## TCG\n\n### Record/Replay\n\n  * fixed record/replay to avoid problems with partial chardev drains\n  * updated replay-dump.py for current ABI\n\n### RISC-V\n\n## Guest agent\n\n  * Fix build on Solaris\n  * Improve help for --allow-rpcs and --block-rpcs command line options\n  * Fix guest-get-fsinfo when a volume has more than one disk (Windows only)\n  * Add support of Windows Server 2025 in guest-get-osinfo command (Windows only)\n\n## Build Information\n\n### Build Dependencies\n\n  * The OpenBSD VM was updated to 7.4\n\n### Build hardening\n\n  * QEMU build will include '-fzero-call-used-regs' to attempt to reduce exploitable ROP gadgets\n  * QEMU build will include '-ftrivial-auto-var-init=zero' to reduce the chance of uninitialized stack variables causing security issues\n\n### Docker Tweaks\n\n### Windows\n\n  * 32-bit Windows is no longer supported as a host OS; use a 64-bit Windows host instead.\n\n### Testing and CI\n\n  * The timeout for TCG tests was raised to 120s (for the benefit of TCI)\n\n## Known issues\n\n  * See https://gitlab.com/qemu-project/qemu/-/milestones/11\n\nRetrieved from\n\"https://wiki.qemu.org/index.php?title=ChangeLog/9.0&oldid=11733\"\n\n  * This page was last edited on 24 April 2024, at 14:32.\n  * Content is available under GNU Free Documentation License 1.2. QEMU is a trademark of Fabrice Bellard.\n\n  * About QEMU\n\n", "frontpage": true}
