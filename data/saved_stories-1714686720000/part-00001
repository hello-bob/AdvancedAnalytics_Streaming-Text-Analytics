{"aid": "40236850", "title": "JsDelivr May Outage Postmortem", "url": "https://www.jsdelivr.com/blog/jsdelivr-may-outage-postmortem/", "domain": "jsdelivr.com", "votes": 1, "user": "cipcoder", "posted_at": "2024-05-02 14:40:28", "comments": 0, "source_title": "jsDelivr May outage postmortem", "source_text": "jsDelivr May outage postmortem\n\njsDelivr - a free open source CDN for npm and github\n\n# jsDelivr May outage postmortem\n\nDuring the night, on May 2, 2024, the jsDelivr CDN domain cdn.jsdelivr.net\nstarted serving an expired SSL certificate to clients connecting from certain\nregions.\n\nThe outage lasted for more than 5 hours and affected users mostly in Africa,\nAsia, and certain countries in Europe and Latin America.\n\nUsers from the USA, Canada, western Europe, Brazil, and many other countries\nwere not affected.\n\nThis disparity was due to our routing between our main CDN providers. Users\nthat were hitting our Fastly CDN endpoint were unaffected.\n\nThe root cause of the outage was Cloudflare\u2019s switch from DigiCert\u2019s\ncertificate authority to Google Trust Services. While the switch itself was\nbenign, it also changed the domain validation method.\n\nSince we\u2019re a multi-CDN, with the traffic being routed between providers based\non our own internal rules, we can\u2019t use Cloudflare DNS hosting and have a\nspecial setup where they only act as the CDN, with DNS being hosted elsewhere.\n\nTo allow Cloudflare to automatically issue and manage our certificates, we\nadded the proper DNS records to our third-party DNS providers. This system\nworked great for almost 10 years now.\n\nUnfortunately, this migration of certificate authorities also made those\nvalidation records obsolete, and switched to HTTP validation instead. This\nwould never work in our case, as depending on where the verification test came\nfrom, it could hit a different CDN provider and fail.\n\nWe were not aware of this change, so what ended up happening was the\nfollowing:\n\n  * The previous working DigiCert was set to expire, as it has happened many times over the years\n  * Some time shortly before the expiration, Cloudflare tried to issue the new certificate using HTTP validation and failed\n  * After it failed, it reverted to an old certificate expired in 2020\n  * None of us or our systems ever expected the managed SSL system to fail\n  * This resulted in an error message to all of our users hitting Cloudflare\u2019s CDN based on our routing\n\nI want to note that Cloudflare is at no fault here, and they have no\nobligation towards anyone to validate rare client configs, especially free\nsponsored ones.\n\nI, @jimaek, take full responsibility for this outage. I should\u2019ve not made any\nassumptions about the migration and should\u2019ve taken extra precautions.\n\nThis outage is embarrassing, and I apologize to everyone who was affected!\n\nThe goal of jsDelivr was always to be a production-ready, most reliable, and\nfastest open-source CDN for anyone to use. This never changed and never will.\n\nThe next steps are:\n\n  * Short-term:\n\n    * Review the full system to ensure that similar issues are automatically handled and re-routed\n    * From now on, any critical changes by CDN providers will immediately result in their deactivation from jsDelivr and manual verification after the fact to ensure the CDN\u2019s stability with our specific setup\n  * Long-term:\n\n    * Optimize, automate, and simplify our DNS, load-balancing, and failover systems and components to prevent other theoretically possible but unknown edge cases\n    * We will integrate our own Globalping service for even better and more reliable monitoring and failover. Consider joining the project by hosting a Docker probe on your network!\n\nThank you to everyone for being with us for so many years, and hope to see you\nall continue this journey forward.\n\n02 May 2024 on announcement\n\n  * \u00a9 jsdelivr.com, 2012 - 2024; designed, developed, and maintained by Prospect One\n\n", "frontpage": false}
