{"aid": "40280568", "title": "Why does a double dash cause this MariaDB clause to evaluate as true?", "url": "https://stackoverflow.com/questions/78431167/why-does-a-double-dash-cause-this-mariadb-clause-to-evaluate-as-true", "domain": "stackoverflow.com", "votes": 2, "user": "yeputons", "posted_at": "2024-05-06 23:16:21", "comments": 0, "source_title": "Why does a double dash (--) cause this MariaDB clause to evaluate as true?", "source_text": "mysql - Why does a double dash (--) cause this MariaDB clause to evaluate as\ntrue? - Stack Overflow\n\n#\n\nJoin Stack Overflow\n\nBy clicking \u201cSign up\u201d, you agree to our terms of service and acknowledge you\nhave read our privacy policy.\n\n# OR\n\nAlready have an account? Log in\n\nSkip to main content\n\nStack Overflow\n\n  1. About\n  2. Products\n  3. For Teams\n\n  1. Stack Overflow Public questions & answers\n  2. Stack Overflow for Teams Where developers & technologists share private knowledge with coworkers\n  3. Talent Build your employer brand\n  4. Advertising Reach developers & technologists worldwide\n  5. Labs The future of collective knowledge sharing\n  6. About the company\n\n##### CollectivesTM on Stack Overflow\n\nFind centralized, trusted content and collaborate around the technologies you\nuse most.\n\nLearn more about Collectives\n\nTeams\n\nQ&A for work\n\nConnect and share knowledge within a single location that is structured and\neasy to search.\n\nLearn more about Teams\n\nGet early access and see previews of new features.\n\nLearn more about Labs\n\n# Why does a double dash (--) cause this MariaDB clause to evaluate as true?\n\nAsk Question\n\nAsked yesterday\n\nModified today\n\nViewed 2k times\n\nThis question shows research effort; it is useful and clear\n\n36\n\nSave this question.\n\nShow activity on this post.\n\nAs part of our introduction to computer security course, we have a short unit\non SQL injections. One of the homework assignments is a basic unsanitized\nlogin page. The expected solution is something along the lines of the classic\n' or 1=1; -- , but we always welcome students to find unconventional\nsolutions.\n\nOne such solution was presented to me recently: inputting '--' for the\npassword seems to perform a successful SQL injection. This would cause the\nquery to be evaluated as something like: SELECT * FROM users WHERE\nname='admin' AND password=''--'';\n\nHere, --''; is not parsed as a comment, since MariaDB requires that comments\nare followed by spaces. In fact, if the double dash was parsed as a comment,\nthis query wouldn't return anything at all; equivalently we would have\npassword='', which would evaluate to false, assuming a non-empty password.\n\nThe extra pair of quotes at the end appears to be necessary: leaving it as\npassword=''--; or inserting other data behind it (password=''--1;) causes the\nconditional to be evaluated as false, as expected.\n\nSome quick testing fails to reproduce this behavior in other databases -- as\nfar as I can tell, this is MariaDB-specific behavior. The documentation\nconfirms that two dashes without a space are not parsed as a comment, but does\nnot elaborate on what they are parsed as instead. EDIT: Somehow I managed to\nmiss the fact that this happens in MySQL too. In fact, this behavior occurs in\nany MySQL fork (not just MariaDB).\n\nWhat does -- do when it is not followed by a space, and why it causing\ncomparisons to evaluate as true?\n\nA toy example:\n\n    \n    \n    CREATE TABLE users ( userid INTEGER PRIMARY KEY, username TEXT NOT NULL, password TEXT NOT NULL ); INSERT INTO users VALUES (0001, 'admin', 'S3cur3P4ssw0rd!'); INSERT INTO users VALUES (0002, 'generic_user', 'Password'); SELECT * FROM users WHERE username='admin' AND password=''; -- empty password, query returns no users SELECT * FROM users WHERE username='admin' AND password=''-- ''; -- parsed as comment, equivalent to above query, returns no users SELECT * FROM users WHERE username='admin' AND password=''--''; -- query returns admin user SELECT * FROM users WHERE username='admin' AND password=''--; -- query returns zero users SELECT * FROM users WHERE username='admin' AND password=''--1; -- query returns zero users\n\n  * mysql\n  * mariadb\n\nShare\n\nCC BY-SA 4.0\n\nImprove this question\n\nFollow this question to receive notifications\n\nedited yesterday\n\nWrench\n\nasked yesterday\n\nWrenchWrench\n\n36311 silver badge66 bronze badges\n\nNew contributor\n\nWrench is a new contributor to this site. Take care in asking for\nclarification, commenting, and answering. Check out our Code of Conduct.\n\n0\n\nAdd a comment |\n\n## 1 Answer 1\n\nReset to default\n\nThis answer is useful\n\n38\n\nSave this answer.\n\nShow activity on this post.\n\nThis specific SQL injection uses two aspects:\n\nFirst, -- without the space, together with a value behind it, is parsed as a\nsubtraction of a negative number. When you run the query\n\n    \n    \n    SELECT '10'--'9'\n\nYou will get the following result:\n\n    \n    \n    +-----------+ | '10'--'9' | +-----------+ | 19 | +-----------+\n\nSo when you run the query\n\n    \n    \n    SELECT ''--''\n\nYou get the result of the first number (0) minus the negative second number\n(-0), which results in 0.\n\n    \n    \n    +--------+ | ''--'' | +--------+ | 0 | +--------+\n\nThe second part is that MariaDB (and MySQL) tries to convert a string to a\nnumber when the current context requires the value to be a number (like in\narithmetic or in numeric comparison, where one operand is already numeric).\nSee the following query:\n\n    \n    \n    SELECT 'some value', '42 apples';\n\nThis results in nothing special:\n\n    \n    \n    +------------+-----------+ | some value | 42 apples | +------------+-----------+ | some value | 42 apples | +------------+-----------+\n\nbut when you do arithmetic like this\n\n    \n    \n    SELECT 'some value'+0, '42 apples'+0;\n\nyou get this:\n\n    \n    \n    +----------------+---------------+ | 'some value'+0 | '42 apples'+0 | +----------------+---------------+ | 0 | 42 | +----------------+---------------+\n\nThis can be used against you with the arithmetic above with a value that\nresults in 0. The query\n\n    \n    \n    SELECT password, ''--'', password+0, password=0, password=''--'' FROM users;\n\nwill show the following results (I added a new user with a number at the\nbeginning of the password):\n\n    \n    \n    +-----------------+--------+------------+------------+-----------------+ | password | ''--'' | password+0 | password=0 | password=''--'' | +-----------------+--------+------------+------------+-----------------+ | S3cur3P4ssw0rd! | 0 | 0 | 1 | 1 | | Password | 0 | 0 | 1 | 1 | | 42 apples | 0 | 42 | 0 | 0 | +-----------------+--------+------------+------------+-----------------+\n\nHere you see, it will first convert the password to a number, most likely 0,\nand then compare it against \"your\" 0 value from ''--'', resulting in a\nsuccessful SQL injection.\n\nShare\n\nCC BY-SA 4.0\n\nImprove this answer\n\nFollow this answer to receive notifications\n\nedited 7 hours ago\n\nanswered yesterday\n\nProgmanProgman\n\n18.2k66 gold badges3838 silver badges5353 bronze badges\n\n4\n\n  * 1\n\nInteresting. I suspected that MariaDB might have been doing some kind of\ncasting, but didn't make the connection between -- and a subtraction. Thanks\nfor the quick answer!\n\n\u2013 Wrench\n\nyesterday\n\n  * Does this mean that (assuming the injection is possible) if using ''--'' the check fails you can deduct that the password starts with a number?\n\n\u2013 John Doe\n\n16 hours ago\n\n  * @JohnDoe not quite, it could be . followed by a number.\n\n\u2013 ysth\n\n9 hours ago\n\n  * @Progman added what I think is an important bit to your explanation; edit to your taste.\n\n\u2013 ysth\n\n9 hours ago\n\nAdd a comment |\n\n##\n\nNot the answer you're looking for? Browse other questions tagged\n\n  * mysql\n  * mariadb\n\nor ask your own question.\n\n  * The Overflow Blog\n  * The reverse mullett model of software engineering\n\n  * Featured on Meta\n  * Testing a new version of Stack Overflow Jobs\n\n  * Our Partnership with OpenAI\n\n  * Policy: Generative AI (e.g., ChatGPT) is banned\n\n  * The [connect] tag is being burninated\n\n10 people chatting\n\n#### Related\n\n1\n\nMariaDB prepareStatement does not convert characterSet for where clause\n\n0\n\nquery returns empty even though it should return a result\n\n2\n\nload_file returns NULL in Mariadb without error. Where is the reason for this\nfailure logged?\n\n0\n\nMySQL query based on condition from another table\n\n1\n\nselect database query getting called frequently in mariadb maxscale\n\n3\n\nMySQL/MariaDB FOUND_ROWS returns 1 even if no rows were returned\n\n1\n\nMySQL: unexpected SELECT result after INSERT into table with autoincrement\ncolumn\n\n0\n\nMariaDB: <SHOW GRANTS FOR USER> does not show table level privileges?\n\n#### Hot Network Questions\n\n  * An SF novel about monasteries which are isolated from the external world for 1, 10, 100 or 1000 years\n\n  * Why do developers often use multiple divs with single classes instead of a single div with multiple classes?\n\n  * Does a US city have the legal power to stop spam mail?\n\n  * Why would two neighboring kingdoms fight over an island?\n\n  * Author and book title that includes \"The Slow Ones\"\n\n  * What happens when I shift gears without pressing the clutch in a manual transmission while the car is running?\n\n  * Do magical items that allow creatures to fly prevent exhaustion from dashing?\n\n  * Are London dispersion forces forces in xenon tetrafluoride strong enough to make it a solid?\n\n  * Can we reproduce Antonio Asis circle interferences?\n\n  * Can the \"Flying Whales\" cargo airship really hover to be able to lift freight on board?\n\n  * How to use AddToHook add code for the env after the beginning code\n\n  * Curved beam on tikz\n\n  * Why shut down Al Jazeera in Israel?\n\n  * Is it true that the U.S. President can cancel any amount of student debt without the approval from the Congress?\n\n  * How to list an honorary position on a CV?\n\n  * How to find a binary vector with minimized distance with a vector set?\n\n  * Hobbies and travelling\n\n  * The closure of the space of Riemannian metrics with a fixed isometry class\n\n  * Which level of myopia is the highest possible to be allowed to drive a car?\n\n  * Can I splice large wire for long runs?\n\n  * Exterior mounting box for replacement porch light\n\n  * Does the top of a wheel really move at twice the velocity of the center?\n\n  * Frege's implication theory\n\n  * Why did Israel invade the Gaza strip from the north and not the south?\n\nQuestion feed\n\n# Subscribe to RSS\n\nlang-sql\n\n  * Blog\n  * Facebook\n  * Twitter\n  * LinkedIn\n  * Instagram\n\nSite design / logo \u00a9 2024 Stack Exchange Inc; user contributions licensed\nunder CC BY-SA. rev 2024.5.3.8609\n\n## We Care About Your Privacy\n\nWe and our 4 partners store and/or access information on a device, such as\nunique IDs in cookies to process personal data. You may accept or manage your\nchoices by clicking below, including your right to object where legitimate\ninterest is used, or at any time in the privacy policy page. These choices\nwill be signaled to our partners and will not affect browsing data.\n\nCookie Policy.\n\n### We and our partners perform the following based on your settings:\n\nUse precise geolocation data. Actively scan device characteristics for\nidentification. Understand audiences through statistics or combinations of\ndata from different sources. Store and/or access information on a device.\nDevelop and improve services. Create profiles to personalise content. Measure\ncontent performance. Use limited data to select content. Measure advertising\nperformance. Use limited data to select advertising. Create profiles for\npersonalised advertising. Use profiles to select personalised advertising. Use\nprofiles to select personalised content.\n\n", "frontpage": false}
