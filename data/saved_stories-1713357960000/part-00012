{"aid": "40060308", "title": "M2dir: Treating mails as files without going crazy", "url": "https://bitfehler.srht.site/posts/2024-04-15_m2dir-treating-mails-as-files-without-going-crazy.html", "domain": "bitfehler.srht.site", "votes": 1, "user": "todsacerdoti", "posted_at": "2024-04-17 04:05:58", "comments": 0, "source_title": "M2dir: treating mails as files without going crazy - bitfehler!", "source_text": "M2dir: treating mails as files without going crazy - bitfehler!\n\n# _M2dir: treating mails as files without going crazy\n\nSometime recently in the past I complained about Maildir. You can go read the\npost, but the executive summary is that I think Maildir uses an actively user-\nhostile directory structure and extremely convoluted filenames that do not\nconvey any meaning at all. For good measure, I will also reiterate that\nMaildir does this for a good reason, and is simply often being used for a\npurpose it wasn\u2019t designed for - storing your mails locally.\n\nUnfortunately, there seem to be no real alternatives. The only other common\nformat for storing mails locally is mbox. But it stores all messages in a\nsingle file, which is unacceptable if you\u2019d like to access them with regular\ntools.\n\nNote: if you have never had the desire or need to access your mails like a\nregular file, this post is likely not of interest to you. If you did, or at\nleast find the idea intriguing, read on, because I am looking for feedback! \ud83d\ude0e\n\nAnd so, without further ado, I present to you: m2dir. If you like\nspecifications, just go and read the whole thing, why not. But for those only\nmildly curious so far, I\u2019ll spell out the basic idea and provide an example\nhere.\n\n## _The gist of it\n\nTo get you started, the main design principles of m2dir are:\n\n  1. each message is a file, with a static ^1 filename\n  2. support for arbitrary message flags ^2\n  3. a simple and standardized directory structure\n  4. a customizable, human-centric part of the filename\n\nI think the first two are pretty self-explanatory.\n\nAbout the third one, I\u2019ll just say: if some mail is in a folder\nINBOX/subfolder, then the file is in $MAIL/INBOX/subfolder. There is no cur or\nnew, no .INBOX.subfolder, or any such shenanigans. Plain and simple, and much\nmore strict about it ^3.\n\nWhat I am most excited about, though, is number four. The spec only dictates\nthat each filename must end a certain way. Since it can be parsed from the\nend, the beginning of the filename is up to the application, and by extension\nto the user. The spec provides an example, which I will also use here for\nillustration. A user might choose a naming scheme such that they may end up\nwith the following filename:\n\n2023-09-04_13:47_builds@sr.ht:GTfrlwJfN5vyR28R\n\nFor any spec-compliant application, only the part :GTfrlwJfN5vyR28R is\nrelevant - that\u2019s the message\u2019s unique ID. In fact, the spec even forbids\napplications from attempting to parse the other part. That part is called the\nhuman-centric part of the filename. It is - in this example - chosen to be a\nrepresentation of the messages Date and From headers.\n\nNote that this is merely a subjective example. So, what value would such a naming scheme provide (for me)? First and foremost, lexicographical ordering, which many tools readily provide (ls, | sort, etc.) also establishes chronological order, which matches my mental model of my mails. In combination with the \u201cfrom\u201d address, I am confident that, given a moderate amount of file names, I could pin-point the one I am looking for just from the filename.\n\nAn example use case might be grepping through all mails. Imagine it returns\n20-30 matches, and the filenames provide enough context that you can spot the\none you\u2019re after. How nice would that be?\n\nOr how about cleaning up? Deleting (or moving) all mails from the previous\nyear would just be a simple shell glob away. The same could be true for\nrestoring backups, for example.\n\nI mean, I know very few people get excited about using dusty CLI tools on\ntheir mails, but given that there is no reason not to, why not at least make\nit possible?\n\nAnd again, this is just an example of how I would like it. The spec lets you\ngo crazy. Prefer the time with seconds? No problem. Fancy your dates in roman\nnumerals? Be my (weird) guest. More seriously, of course, you might live\nsomeplace that uses a different calendar, doesn\u2019t use Arabic numerals, or\nmaybe you just don\u2019t want any date in the filename at all. The spec has you\ncovered, by not covering this part.\n\n## _Now what?\n\n\u201cCool\u201d, you might think, \u201cwhere do I sign up?\u201d. Well...\n\nThere is work ongoing, but frankly, nothing is done yet. In fact, I wanted to\nget this out now, because maybe someone out there has some really valuable\nfeedback that should be incorporated before I declare the spec done. So if you\nfind this interesting, have questions or comments, why not reach out to the\nmailing list?\n\nJust to set expectations, though: drastic changes are very unlikely. This has\nbeen through quite some iterations, and many things are now the way they are\nfor pretty good reasons. But any arguments may still be worth having, so if in\ndoubt, I\u2019d like to hear from you!\n\nThat of course also means: if you think this might be something you\u2019d like to\nimplement in a project you maintain, there is probably not much harm in\nstarting with some prototype - any potential changes should be minor. And of\ncourse, let me know about it!\n\nSo, there, I did it. I\u2019d like to thank Drew and Simon for their very early\nfeedback, which tremendously helped me finding the right direction, and Knut\nfor his enthusiasm, which helped me to finally kick this out the door!\n\n  1. The name of a file does not change when the message\u2019s flags change, like it does with Maildir\u21a9\ufe0e\n\n  2. Sometimes also called \u201ckeywords\u201d in IMAP\u21a9\ufe0e\n\n  3. This paragraph assumes some basic knowledge of Maildir/Maildir++ - if you\u2019re not familiar, see my previous rant about it\u21a9\ufe0e\n\nPosted: 2024-04-15 - back to blog - All content is CC-BY-SA - source\n\n", "frontpage": false}
