{"aid": "40273086", "title": "Refactor: Utilities for refactoring and upgrading Ruby code based on ASTs", "url": "https://github.com/baweaver/refactor", "domain": "github.com/baweaver", "votes": 1, "user": "thunderbong", "posted_at": "2024-05-06 10:35:00", "comments": 0, "source_title": "GitHub - baweaver/refactor: Utilities for refactoring and upgrading Ruby code based on ASTs.", "source_text": "GitHub - baweaver/refactor: Utilities for refactoring and upgrading Ruby code\nbased on ASTs.\n\nSkip to content\n\n## Navigation Menu\n\nSign in\n\n# Search code, repositories, users, issues, pull requests...\n\nSearch syntax tips\n\nSign in\n\nSign up\n\nYou signed in with another tab or window. Reload to refresh your session. You\nsigned out in another tab or window. Reload to refresh your session. You\nswitched accounts on another tab or window. Reload to refresh your session.\nDismiss alert\n\nbaweaver / refactor Public\n\n  * Notifications\n  * Fork 0\n  * Star 6\n\nUtilities for refactoring and upgrading Ruby code based on ASTs.\n\n### License\n\nMIT license\n\n6 stars 0 forks Branches Tags Activity\n\nStar\n\nNotifications\n\n# baweaver/refactor\n\nThis commit does not belong to any branch on this repository, and may belong\nto a fork outside of the repository.\n\n1 Branch\n\n0 Tags\n\n## Folders and files\n\nName| Name| Last commit message| Last commit date  \n---|---|---|---  \n  \n## Latest commit\n\nbaweaverRunner and CLI basicsMay 6, 2024dce251d \u00b7 May 6, 2024May 6, 2024\n\n## History\n\n4 Commits  \n  \n### .github/workflows\n\n|\n\n### .github/workflows\n\n| Update workflow| May 6, 2024  \n  \n### bin\n\n|\n\n### bin\n\n| Runner and CLI basics| May 6, 2024  \n  \n### lib\n\n|\n\n### lib\n\n| Runner and CLI basics| May 6, 2024  \n  \n### refactor_rules\n\n|\n\n### refactor_rules\n\n| Runner and CLI basics| May 6, 2024  \n  \n### sandbox\n\n|\n\n### sandbox\n\n| Runner and CLI basics| May 6, 2024  \n  \n### sig\n\n|\n\n### sig\n\n| Initial release| May 6, 2024  \n  \n### spec\n\n|\n\n### spec\n\n| Initial release| May 6, 2024  \n  \n### .gitignore\n\n|\n\n### .gitignore\n\n| Runner and CLI basics| May 6, 2024  \n  \n### .rspec\n\n|\n\n### .rspec\n\n| Initial release| May 6, 2024  \n  \n### .rubocop.yml\n\n|\n\n### .rubocop.yml\n\n| Runner and CLI basics| May 6, 2024  \n  \n### .ruby-version\n\n|\n\n### .ruby-version\n\n| Initial release| May 6, 2024  \n  \n### CHANGELOG.md\n\n|\n\n### CHANGELOG.md\n\n| Runner and CLI basics| May 6, 2024  \n  \n### CODE_OF_CONDUCT.md\n\n|\n\n### CODE_OF_CONDUCT.md\n\n| Initial release| May 6, 2024  \n  \n### Gemfile\n\n|\n\n### Gemfile\n\n| Initial release| May 6, 2024  \n  \n### Gemfile.lock\n\n|\n\n### Gemfile.lock\n\n| Runner and CLI basics| May 6, 2024  \n  \n### Guardfile\n\n|\n\n### Guardfile\n\n| Initial release| May 6, 2024  \n  \n### LICENSE.txt\n\n|\n\n### LICENSE.txt\n\n| Initial release| May 6, 2024  \n  \n### README.md\n\n|\n\n### README.md\n\n| Initial release| May 6, 2024  \n  \n### Rakefile\n\n|\n\n### Rakefile\n\n| Initial release| May 6, 2024  \n  \n### refactor.gemspec\n\n|\n\n### refactor.gemspec\n\n| Runner and CLI basics| May 6, 2024  \n  \n## Repository files navigation\n\n# Refactor\n\nUtilities for refactoring and upgrading Ruby code based on ASTs.\n\nConsider reading ASTs in Ruby - Pattern Matching as a primer for using this\ngem, as it will introduce concepts of pattern matching and ASTs in more\ndetail.\n\n## Original Attribution\n\nThis gem is a continuation of the work by @afeld and their Refactor gem here:\n\nhttps://github.com/afeld/refactor\n\n## Usage\n\nRefactor works via rules, similar to RuboCop:\n\n    \n    \n    # Inherits from base rule, which provides a lot of utilities # to match and replace with. class ShorthandRule < Refactor::Rule # The code we're trying to work with here is: # # [1, 2, 3].select { |v| v.even? } # # ...and we want to make it into: # # [1, 2, 3].select(&:even?) # def on_block(node) return unless node in [:block, receiver, [[:arg, arg_name]], [:send, [:lvar, ^arg_name], method_name] ] replace(node, \"#{receiver.source}(&:#{method_name})\") end end ShorthandRule.process(\"[1, 2, 3].select { |v| v.even? }\") # => [1, 2, 3].select(&:even?)\n\nIf we add multiple rules we'll want to use a Rewriter instead to apply all of\nthem without the potential for collision:\n\n    \n    \n    class BigDecimalRule < Refactor::Rule def on_send(node) return unless node in [:send, _, :BigDecimal, [:float | :int, value] ] replace(node, \"BigDecimal('#{value}')\") end end class HashRefDefaultRule < Refactor::Rule def on_send(node) return unless node in [:send, [:const, nil, :Hash], :new, [:array | :hash] => reference_value ] replace(node, \"Hash.new { |h, k| h[k] = #{reference_value.source} }\") end end rewriter = Refactor::Rewriter.new(rules: [ShorthandRule, BigDecimalRule, HashRefDefaultRule]) rewriter.process <<~RUBY [1, 2, 3].select { |v| v.even? } value = BigDecimal(5.3) groups = Hash.new({}) RUBY # => <<~RUBY # [1, 2, 3].select(&:even?) # # value = BigDecimal('5.3') # groups = Hash.new { |h, k| h[k] = {} } # RUBY\n\n## Why Not RuboCop?\n\nIn most cases you likely want to use RuboCop as it has more robust support and\ntesting. This gem is currently more experimental and focused exclusively on\nrefactoring and AST manipulations in a more minimal sense.\n\n## Installation\n\nInstall the gem and add to the application's Gemfile by executing:\n\n    \n    \n    bundle add refactor\n\nIf bundler is not being used to manage dependencies, install the gem by\nexecuting:\n\n    \n    \n    gem install refactor\n\n## Development\n\nAfter checking out the repo, run bin/setup to install dependencies. Then, run\nrake spec to run the tests. You can also run bin/console for an interactive\nprompt that will allow you to experiment.\n\nTo install this gem onto your local machine, run bundle exec rake install. To\nrelease a new version, update the version number in version.rb, and then run\nbundle exec rake release, which will create a git tag for the version, push\ngit commits and the created tag, and push the .gem file to rubygems.org.\n\n## Contributing\n\nBug reports and pull requests are welcome on GitHub at\nhttps://github.com/baweaver/refactor. This project is intended to be a safe,\nwelcoming space for collaboration, and contributors are expected to adhere to\nthe code of conduct.\n\n## License\n\nThe gem is available as open source under the terms of the MIT License.\n\n## Code of Conduct\n\nEveryone interacting in the Refactor project's codebases, issue trackers, chat\nrooms and mailing lists is expected to follow the code of conduct.\n\n## About\n\nUtilities for refactoring and upgrading Ruby code based on ASTs.\n\n### Resources\n\nReadme\n\n### License\n\nMIT license\n\n### Code of conduct\n\nCode of conduct\n\nActivity\n\n### Stars\n\n6 stars\n\n### Watchers\n\n1 watching\n\n### Forks\n\n0 forks\n\nReport repository\n\n## Releases\n\nNo releases published\n\n## Packages 0\n\nNo packages published\n\n## Languages\n\n  * Ruby 99.4%\n  * Shell 0.6%\n\n## Footer\n\n\u00a9 2024 GitHub, Inc.\n\nYou can\u2019t perform that action at this time.\n\n", "frontpage": false}
