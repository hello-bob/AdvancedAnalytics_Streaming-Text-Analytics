{"aid": "40202924", "title": "Iroh v0.15.0 \u2013 Shut me down", "url": "https://iroh.computer/blog/iroh-0-15-0-shut-me-down", "domain": "iroh.computer", "votes": 1, "user": "b_fiive", "posted_at": "2024-04-29 19:30:26", "comments": 0, "source_title": "Iroh 0.15.0 - Shut me down", "source_text": "Iroh 0.15.0 - Shut me down - Iroh\n\nJoin Beta\n\nBlog Index\n\n# Iroh 0.15.0 - Shut me down\n\nApril 29, 2024 by dignifiedquire\n\nWhat, another iroh release, you say? Yes, we have decided to move to a regular\nrelease cadence of every two weeks. And so, here we are, two weeks after 0.14!\n\nAnd a lot has happened in the last two weeks, from better shutdown to more\ndialing options to an integrated downloader, there should be something in this\nrelease for everyone.\n\n## \ud83d\udeaa Graceful Shutdown\n\nShutting down should be easy: just kill everything. Right? Well, it turns out\nthat\u2019s not always what you want. Sometimes you may want to wait for clients to\nfinish and other times you may want to restart things without exiting the\nprocess.\n\nWe tried to handle shutdown cleanly, as well as we could, from very early on\nin Iroh\u2019s development, but we did not always succeed. One of the symptoms was\noften visible when using the CLI, the dreaded quinn::endpoint error:\n\n    \n    \n    ERROR quinn::endpoint: I/O error: connection closed\n\nWe finally found a way to avoid this error, and now more gracefully handle\nexiting the MagicEndpoint when terminating QUIC and the underlying\nconnections.\n\nFor more details check out: Improve magicsock's shutdown story (#2227)\n\n## \u2935\ufe0f Integrated Downloader\n\nWhen downloading content, you can now use the Queued downloader mode. This\nallows you to hook into the general downloader queue shared between documents\nand blobs in Iroh. This allows for better resource management and more unified\nreporting on download progress.\n\nIf you want the old behaviour, you can still get it using Direct mode.\n\n    \n    \n    let req = BlobDownloadRequest { hash, format: BlobFormat::Raw, // New feature: you can now specify multiple sources // which will be tried in order nodes: vec![NodeAddr::new(node_id)], tag: SetTagOption::Auto, mode: DownloadMode::Queued, }; let progress = node.blobs.download(req).await?; let outcome = progress.await?;\n\nFor more details check out: Refactor downloader queue and add progress\nreporting (#2085)\n\n## \u260e\ufe0f Expanded Support for dialing by only NodeID\n\nIn the last release, we introduced iroh-dns, which allows us to dial by Node\nID. In this release, we have expanded our APIs to enable easy dialing by Node\nID and generating tickets with just a Node ID.\n\nBy default, tickets generated on the CLI will now only include the Node ID,\nand are much shorter now. Compare the new default before and after:\n\n    \n    \n    # 0.14 > doc share write docaaacarwhmusoqf362j3jpzrehzkw3bqamcp2mmbhn3fmag3mzzfjp4beahj2v7aezho\\ jvfqi5wltr4vxymgzqnctryyup327ct7iy4s5noxy6ajdnb2hi4dthixs6zlvo4ys2mjooj\\ swyylzfzuxe33ifzxgk5dxn5zgwlrpaiac4bl3upcfoagavaaznrcx # 0.15 > doc share write docaaacarwhmusoqf362j3jpzrehzkw3bqamcp2mmbhn3fmag3mzzfjp4beahj2v7aezho\\ jvfqi5wltr4vxymgzqnctryyup327ct7iy4s5noxy6aaa\n\nIf you still want to add relay and direct addresses to the ticket, you can\npass --addr-options RelayAndAddresses to the ticket generation commands.\n\nFor more details check out: Implement improved address sharing options (#2230)\n\n## \ud83d\uddc4\ufe0f More binaries\n\nYou asked and we delivered! We are finally attaching prebuilt binaries to our\nreleases. And yes, the new linux binaries are using musl, so no more outdated\nglibc errors \ud83d\ude03\n\nThe binaries that are now available are:\n\n  * iroh - The main CLI\n  * iroh-dns-server - The DNS server powering iroh-dns\n  * iroh-relay - The relay server powering our relay network\n\n## \u26a0\ufe0f Breaking Changes\n\nIroh is evolving fast. At this phase breaking changes are a necessary fact of\nlife development, but we recognize updating a dependency through breaking API\nchanges can be a painful.\n\nThere are two major types of breaking changes: protocol changes, and API\nchanges. Protocol changes affect the actual data and communication patterns\nbetween iroh nodes. A protocol-breaking change requires all nodes that want to\ncommunicate with each other either upgrade or implement backwards-\ncompatibility.\n\nThe second form are API changes, which requires updating any code that imports\niroh to integrate the changes. But they don\u2019t affect the communication between\nnodes.\n\nMoving forward, we\u2019re tracking breaking changes more closely. Breaking changes\nto public APIs are monitored as part of CI, and will be documented in the pull\nrequest introducing them.\n\nProtocol breaking changes are not tracked in CI, but are also expected to be\ndocumented in the PRs introducing them.\n\n### Protocol Changes\n\nNo protocol-breaking changes this time around \ud83c\udf89.\n\n### API Changes\n\n#### iroh\n\n  * Renamed:\n\n    * iroh::client::blobs::ShareTicketOptions -> iroh_base::node_addr::AddrInfoOptions\n  * Changed:\n\n    * Default for AddrInfoOptions is now Id, before it was RelayandAddresses\n  * Added\n\n    * addr_options to iroh::client::docs::Docs.share\n    * Id varint to AddrInfoOptions\n    * The BlobDownloadRequest has a new field mode to select between direct and queued downloads, and now contains a list of nodes in place of a single node before\n\n#### iroh-bytes\n\n  * Removed:\n\n    * Role enum\n  * Downloader::queue now takes a DownloadRequest with more options than before\n  * DownloadProgress has a new variant InitialState which is emitted when attaching to an already-running download\n  * ConcurrencyLimits gained a new field\n\n#### iroh-net\n\n  * MagicEndpoint::close now consumes the endpoint.\n  * Added\n\n    * RelayUrlInfo combines the relay_url and additional information about the state of our connection\n  * Renamed:\n\n    * MagicSock::tracked_endpoints -> MagicSock::connection_infos\n    * MagicSock::tracked_endpoint -> MagicSock::connection_info\n    * magicsock::EndpointInfo -> magicsock::ConnectionInfo\n    * iroh_net::magicsock::ConnectionType -> iroh_net::magic_endpoint::ConnectionType\n    * iroh_net::magicsock::ControlMsg -> iroh_net::magic_endpoint::ControlMsg\n    * iroh_net::magicsock::ConnectionInfo -> iroh_net::magic_endpoint::ConnectionInfo\n    * iroh_net::magicsock::ConnectionTypeStream -> iroh_net::magic_endpoint::ConnectionTypeStream\n    * iroh_net::magicsock::DirectAddrInfo -> iroh_net::magic_endpoint::DirectAddrInfo\n    * iroh_net::magicsock::LocalEndpointsStream -> iroh_net::magic_endpoint::LocalEndpointsStream\n  * Now private:\n\n    * module magicsock\n    * iroh_net::magicsock::MagicSock Use MagicEndpoint instead.\n    * iroh_net::magicsock::Options\n    * iroh_net::magicsock::PacketSplitIter\n    * iroh_net::magicsock::Timer\n    * iroh_net::magicsock::UdpSocket\n\n#### iroh-dns-server\n\n  * iroh_dns_server::config::Config struct has a new field mainline.\n\n#### iroh-cli\n\n  * Renamed:\n\n    * doc share --ticket-options -> doc share --addr-options\n\n#### Other\n\n  * Moved: SetTagOption from iroh to iroh-bytes\n\n## But wait there\u2019s more!\n\nMany bugs were squashed and smaller features were added. For all those details\nyou can check out the full changelog:\nhttps://github.com/n0-computer/iroh/releases/tag/v0.15.0.\n\nIf you want to know what is coming up, check out the 0.16.0 milestone, and if\nyou have any wishes let us know in the issues! If you need help using iroh or\njust want to chat, please join us on discord!\n\n## Footer\n\nLess net work for networks.\n\nTwitterGitHubYouTube\n\n### Build\n\n  * Documentation\n  * iroh.network\n  * Github\n\n### Learn\n\n  * Blog\n  * Examples\n  * dumbpipe\n  * sendme\n\n### Connect\n\n  * Discord\n  * Discussion\n  * Twitter\n\n\u00a9 2024 n0, inc.\n\n", "frontpage": false}
