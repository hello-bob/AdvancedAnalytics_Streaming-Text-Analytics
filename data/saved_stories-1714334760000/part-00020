{"aid": "40187934", "title": "Compiling MS-DOS 4.0 from DOS 4.0, on a PS/2", "url": "https://virtuallyfun.com/2024/04/28/compiling-ms-dos-4-0-from-dos-4-0-on-a-ps-2/", "domain": "virtuallyfun.com", "votes": 2, "user": "tiernano", "posted_at": "2024-04-28 11:54:02", "comments": 0, "source_title": "Compiling MS-DOS 4.0 from DOS 4.0, on a PS/2!", "source_text": "Compiling MS-DOS 4.0 from DOS 4.0, on a PS/2! | Virtually Fun\n\nManage Consent\n\nTo provide the best experiences, we use technologies like cookies to store\nand/or access device information. Consenting to these technologies will allow\nus to process data such as browsing behavior or unique IDs on this site. Not\nconsenting or withdrawing consent, may adversely affect certain features and\nfunctions.\n\nManage options Manage services Manage {vendor_count} vendors Read more about\nthese purposes\n\nView preferences\n\nPrivacy Policy Privacy Policy\n\nSkip to primary content\n\n# Virtually Fun\n\n## Fun with Virtualization\n\n# Compiling MS-DOS 4.0 from DOS 4.0, on a PS/2!\n\nPosted on April 28, 2024 by neozeed\n\nhave patience. It does work. Even booting from the SPOCK SCSI CARD which all\nthe other DOS4 images all failed.\n\nThe best way for a native build is the zip in the releases.\n\nRelease Now can boot from hard disk! \u00b7 neozeed/dos400 (github.com)\n\nWith a 16Mhz 80386 it took 70 minutes. I just formatted a blank image on the\ngotek, copied IO.SYS, MSDOS.SYS and COMMAND.COM, then rebooted. went back to\nthe compiled DOS 4, and re-formatted the floppy as a system disk so the\nattributes are set. (DOS 5 lets you change system files), and yeah. It can be\ndone!\n\nLet me spell out the steps, in this case I\u2019m going to use Windows 10. I use\nthe git from the WSL (Windows subsystem for Linux) I have DOSBox mount c:\\dos\nas my c: drive . ZIP/UNZIP are Info-ZIP versions, you MUST have the Win32\nnative version!\n\n    \n    \n    - md \\dos - md \\dos\\temp - wsl git clone https://github.com/microsoft/MS-DOS - cd MS-DOS\\v4.0 - zip -r \\dos\\temp\\src.zip src\\*.* - cd \\dos - unzip -a -LL temp\\src.zip - start dosbox - cd \\src - edit setenv.bat to reflect the paths: set BAKROOT=c: set LIB=%BAKROOT%\\src\\tools\\bld\\lib set INCLUDE=%BAKROOT%\\src\\tools\\bld\\inc set PATH=%PATH%;%BAKROOT%\\src\\tools - setenv - nmake it will then fail in mapper on getmsg.asm change the 3 chars to a '-' - nmake - cd .. - nmake\n\nIt will then fail building select\n\n    \n    \n    - edit select2.asm - edit usa.inf - nmake - cd .. - nmake\n\nand now it\u2019ll be done compiling.\n\ncontinuing from dosbox, you need a 1.44mb fat formatted disk image\nsomedos144.img . I used a dos 6.22 diskette, it needs the bootsector already\nin place to load io.sys/msdos.sys\n\n    \n    \n    - cd \\src - md bin - cpy bin - imgmount a somedos144.img -t floppy - a: - del *.* - copy c:\\src\\bin\\io.sys - copy c:\\src\\bin\\msdos.sys - copy c:\\src\\bin\\http://command.com - boot -l a:\n\nAnd now I\u2019ve booted MS-DOS 4.00 from within DOBOX!\n\nAlso as interest to most people there is a bug in msload.asm, where DOS 4.0\nwon\u2019t boot on a lot of machines, from VMware, Qemu and even my PS/2. It\u2019s a\nsmall fix to the IO.SYS initial stack being too small. Props to Michal Necasek\nfor the fix!\n\nFor further guidance here is a video spelling it all out:\n\nThis entry was posted in 80386, MS-DOS, PS/2, source code by neozeed. Bookmark\nthe permalink.\n\n### Leave a Reply Cancel reply\n\nThis site uses Akismet to reduce spam. Learn how your comment data is\nprocessed.\n\nPrivacy Policy Proudly powered by WordPress\n\n", "frontpage": false}
